<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : JPA - Hibernate</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Basic_289898911.html">Basic</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : JPA - Hibernate
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 20, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="JPA-Hibernate-References">References</h2><p>Refer to following links:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Lesson URL:</p></td><td class="confluenceTd"><p><a href="https://courses.in28minutes.com/p/jpa-and-hibernate-tutorial-for-beginners-with-spring-boot" class="external-link" rel="nofollow">https://courses.in28minutes.com/p/jpa-and-hibernate-tutorial-for-beginners-with-spring-boot</a></p></td></tr><tr><td class="confluenceTd"><p>GS Git Repo:</p></td><td class="confluenceTd"><p><a href="https://gitlab-uat.gs.com/gunern/springboot-jpa.git" class="external-link" rel="nofollow">https://gitlab-uat.gs.com/gunern/springboot-jpa.git</a></p></td></tr></tbody></table></div><h2 id="JPA-Hibernate-CreateSpringBootStarterApplication"><a href="https://confluence.apg.services.gs.com/display/~gunern/Spring+Boot#SpringBoot-INITIALIZR" class="external-link" rel="nofollow">Create Spring Boot Starter Application</a></h2><h2 id="JPA-Hibernate-ExamineFilesintheStarterApplication">Examine Files in the Starter Application</h2><h3 id="JPA-Hibernate-EntryPoint-GeneratedSpringBootApplicationClass">Entry Point - Generated SpringBoot Application Class</h3><p>Check the class that was created with the SPRING INITIALIZR with the main method:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code>@SpringBootApplication</code></p><p><code>public class SpringbootJpaApplication</code></p><p><code>{</code></p><p><code>public static void main(String[] args)</code></p><p><code>{</code></p><p><code>SpringApplication.run(SpringbootJpaApplication.class, args);</code></p><p><code>}</code></p><p><code>}</code></p></td></tr></tbody></table></div><p><br/></p><h3 id="JPA-Hibernate-pom.xml">pom.xml</h3><p>Note the <code>&lt;parent&gt;</code> section that is responsible for Spring Boot</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code>&lt;parent&gt;</code></p><p><code>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</code></p><p><code>&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</code></p><p><code>&lt;version&gt;2.1.8.RELEASE&lt;/version&gt;</code></p><p><code>&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</code></p><p><code>&lt;/parent&gt;</code></p></td></tr></tbody></table></div><h3 id="JPA-Hibernate-NoteWeb,JPA,H2Dependencis">Note Web, JPA, H2 Dependencis</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
   &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><code>&lt;dependency&gt;</code></p><p><code>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</code></p><p><code>&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</code></p><p><code>&lt;/dependency&gt;</code></p></td></tr><tr><td class="confluenceTd"><p><code>&lt;dependency&gt;</code></p><p><code>&lt;groupId&gt;com.h2database&lt;/groupId&gt;</code></p><p><code>&lt;artifactId&gt;h2&lt;/artifactId&gt;</code></p><p><code>&lt;scope&gt;runtime&lt;/scope&gt;</code></p><p><code>&lt;/dependency&gt;</code></p></td></tr></tbody></table></div><h2 id="JPA-Hibernate-Createanin-memorydatabase">Create an in-memory database</h2><h3 id="JPA-Hibernate-CreateanEntityClass">Create an Entity Class</h3><p>We will need to create at least one Entity class. The Entity is a POJO that will map to a database table. For this example, we will create a User class with three fields:<code> id, name</code>, and <code>role</code>. With will designate the &quot;id&quot; field as a primary, auto-generated field. Note annotations: @Entity, @Id, and <code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class User
{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;
    private String name;
    private String role;

    public User(String name, String role)
    {
        this.name = name;
        this.role = role;
    }

    protected User()
    {
    }

    public long getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getRole() {
        return role;
    }

    @Override
    public String toString()
    {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, role=&#39;&quot; + role + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }

}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="JPA-Hibernate-CreateaRepositoryclass">Create a Repository class</h3><p>We also need to create an interface which will extend <code>JpaRepository</code>. Generic parameters to the <code>JpaRepository</code> interface will be the name of our <code>Entity</code> class and the type of its primary key:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface UserRepository extends JpaRepository&lt;User, Long&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><p>This is all the code we need to initialize a User table in the H2 in-memory database.</p><h3 id="JPA-Hibernate-SetHibernatepropertiesinsideapplication.propertiesfile">Set Hibernate properties inside application.properties file</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.jpa.show-sql=true
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:testdb</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="JPA-Hibernate-Primein-memorydatabasewithData">Prime in-memory database with Data</h3><p>The only thing that remains is to populate the User table with some data. To accommodate, we will create a file inside the <code>resources</code> package to prime out User table with data.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">INSERT INTO USER(id, name, role) VALUES(0, &#39;nick&#39;, &#39;dev&#39;)
INSERT INTO USER(id, name, role) VALUES(1, &#39;paul&#39;, &#39;tech&#39;)
INSERT INTO USER(id, name, role) VALUES(2, &#39;sam&#39;, &#39;dev&#39;)
INSERT INTO USER(id, name, role) VALUES(3, &#39;mary&#39;, &#39;support&#39;)
INSERT INTO USER(id, name, role) VALUES(4, &#39;jim&#39;, &#39;manager&#39;)</pre>
</div></div></td></tr></tbody></table></div><h2 id="JPA-Hibernate-RunApplicationandChecktheDatabase">Run Application and Check the Database</h2><p>Run the application and point your browser to:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/h2-console" class="external-link" rel="nofollow">http://localhost:8080/h2-console</a></p></td></tr><tr><td class="confluenceTd"><p>Display</p></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/592493448/image2019-9-12_15-22-50.png?version=1&amp;modificationDate=1568316170237&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/592493448/image2019-9-12_15-22-50.png?version=1&amp;modificationDate=1568316170237&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p>For JDBC URL specify:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>JDBC URL:</p></td><td class="confluenceTd"><p><code>jdbc:h2:mem:testdb</code></p></td></tr></tbody></table></div><p>Execute Query to verify data:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Query:</p></td><td class="confluenceTd"><p>SELECT * FROM USER</p></td></tr><tr><td class="confluenceTd"><p>Data:</p></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/592493448/image2019-9-16_15-32-20.png?version=1&amp;modificationDate=1568662340543&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/592493448/image2019-9-16_15-32-20.png?version=1&amp;modificationDate=1568662340543&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p><br/></p><h2 id="JPA-Hibernate-PerformCRUDOperationsProgrammatically">Perform CRUD Operations Programmatically</h2><p>Spring Boot will run all classes that implement the CommandLineRunner interface. We create a class to perform a few CRUD operations programmatically and log output to the console.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Component
public class UserRepositoryCommandLineRunner implements CommandLineRunner
{
    private final Logger logger = LoggerFactory.getLogger(getClass());

    @Autowired
    private UserRepository userRepository;

    @Override
    public void run(String... args) throws Exception
    {
        //  Retrieve single user
        Optional&lt;User&gt; userWithId1 = userRepository.findById(1L);
        logger.info(&quot;User retrieved: {}&quot;, userWithId1);

        //  Retrieve all users
        List&lt;User&gt; users = userRepository.findAll();
        logger.info(&quot;All Users: {}&quot;, users);

        //  Add a new user
        User user = new User(&quot;Jill&quot;, &quot;Admin&quot;);
        userRepository.save(user);
        logger.info(&quot;New user created: {}&quot;, user);
    }
}


</pre>
</div></div></td></tr></tbody></table></div><h3 id="JPA-Hibernate-Runapplicationandnoteinformationinthelog">Run application and note information in the log</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
User retrieved: Optional[User{id=1, name=&#39;nick&#39;, role=&#39;dev&#39;}]
...
All Users: [User{id=1, name=&#39;nick&#39;, role=&#39;dev&#39;}, User{id=2, name=&#39;paul&#39;, role=&#39;tech&#39;}, User{id=3, name=&#39;sam&#39;, role=&#39;dev&#39;}, User{id=4, name=&#39;mary&#39;, role=&#39;support&#39;}, User{id=5, name=&#39;jim&#39;, role=&#39;manager&#39;}]
...
New user created: User{id=6, name=&#39;Jill&#39;, role=&#39;Admin&#39;}
...</pre>
</div></div></td></tr></tbody></table></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
