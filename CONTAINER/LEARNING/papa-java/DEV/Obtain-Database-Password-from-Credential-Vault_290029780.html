<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Obtain Database Password from Credential Vault</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Eligibility_289898573.html">Eligibility</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Obtain Database Password from Credential Vault
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 19, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>So far we specified all credentials including UserId and Password inside application.properties file. This approach is not ideal. In this section we demonstrate how to obtain these credentials from the Credential Vault.</p><p>Connect to <a href="https://confluence.apg.services.gs.com/display/~gunern/Credential+Vault" class="external-link" rel="nofollow">Credential Vault</a> to view credential reference.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Credential</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Credential Reference</strong></p></th></tr><tr><td class="confluenceTd"><p><code>dutysepdbuat</code></p></td><td class="confluenceTd"><p><code>d0276c30462d4e3c99d7fc2be92a8c69</code></p></td></tr></tbody></table></div><h1 id="ObtainDatabasePasswordfromCredentialVault-AddCredentialVaultdependencytopom.xml">Add Credential Vault dependency to <code>pom.xml</code></h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
&lt;dependency&gt;
   &lt;groupId&gt;com.gs.spring&lt;/groupId&gt;
   &lt;artifactId&gt;gs-spring-boot-credential-vault&lt;/artifactId&gt;
   &lt;version&gt;2.1.7&lt;/version&gt;
&lt;/dependency&gt;
...</pre>
</div></div></td></tr></tbody></table></div><h1 id="ObtainDatabasePasswordfromCredentialVault-AddCredentialVaultComponenttotheconfigpackage">Add <code>CredentialVault</code> Component to the <code>config</code> package</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Component
public class CredentialVault
{
    public SystemAccount getSystemAccount(String credRef, String systemAccountName)
    {
        String userName = System.getProperty(&quot;user.name&quot;);
        System.setProperty(&quot;user.name&quot;, systemAccountName);
        CredentialLookUp&lt;SystemAccount&gt; credentialLookUp = new CredentialLookUp&lt;&gt;();
        SystemAccount systemAccount = credentialLookUp.getCredentialObject(credRef);
        System.setProperty(&quot;user.name&quot;, userName);
        return systemAccount;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h1 id="ObtainDatabasePasswordfromCredentialVault-MakechangestoDataSourceConfigclasstoretrievepasswordfromCredentialVault">Make changes to DataSourceConfig class to retrieve password from Credential Vault</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
@Profile({&quot;db2&quot;})
public class DataSourceConfig
{
    @Value(&quot;${datasource.driver-class-name}&quot;)
    String dataSourceDriverClass;

    @Value(&quot;${datasource.url}&quot;)
    String dataSourceUrl;

    @Value(&quot;${datasource.system.account.name}&quot;)
    String systemAccountName;

    @Value(&quot;${datasource.system.account.credref}&quot;)
    String credRef;

    @Bean
    public DataSource getDataSource(CredentialVault credentialVault)
    {
        SystemAccount systemAccount = credentialVault.getSystemAccount(credRef, systemAccountName);
        return DataSourceBuilder
                .create()
                .username(systemAccountName)
                .password(systemAccount.getPassword())
                .url(dataSourceUrl)
                .driverClassName(dataSourceDriverClass)
                .build();
    }
}</pre>
</div></div></td></tr></tbody></table></div><h1 id="ObtainDatabasePasswordfromCredentialVault-Addpropertiestoapplication.propertiesfiletousedatafromCredentialVault">Add properties to application.properties file to use data from Credential Vault</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
datasource.system.account.name=dutysepdbuat
datasource.system.account.credref=d0276c30462d4e3c99d7fc2be92a8c69
...</pre>
</div></div></td></tr></tbody></table></div><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
