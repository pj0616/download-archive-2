<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Library Application Example</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Basic_289898911.html">Basic</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Library Application Example
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 20, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>In this tutorial we continue from the <a href="https://confluence.apg.services.gs.com/display/~gunern/Embedded+Resource+Support" class="external-link" rel="nofollow">Embedded Resource Support</a> tutorial. We will create a very basic Library application consisting of Users and Books and create a mapping between them. We will skips steps on creating a Spring Boot application since they are explained in multiple sections within this category.</p><h2 id="LibraryApplicationExample-GitRepository">Git Repository</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 90.0px;"/><col style="width: 668.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URLs</p></td><td class="confluenceTd"><p><br/></p><p>library<a href="https://gitlab-uat.gs.com/gunern/library.git" class="external-link" rel="nofollow">https://gitlab-uat.gs.com/gunern/library.git</a>new-library</p><p><a href="https://gitlab-uat.gs.com/gunern/new-library.git" class="external-link" rel="nofollow">https://gitlab-uat.gs.com/gunern/new-library.git</a></p><p>audit-library<a href="https://gitlab-uat.gs.com/gunern/audit-library.git" class="external-link" rel="nofollow">https://gitlab-uat.gs.com/gunern/audit-library.git</a></p><p><br/></p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Note">Note</h3><p>Code snippets presented on this page demonstrate evolutionary steps of this project. For latest and tested code refer to the Git repository shown above.</p><h2 id="LibraryApplicationExample-AddSupportforSwaggerPage">Add Support for Swagger Page</h2><h3 id="LibraryApplicationExample-Modifypom.xmlfile">Modify pom.xml file</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-data-rest&lt;/artifactId&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;com.h2database&lt;/groupId&gt;
      &lt;artifactId&gt;h2&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
      &lt;scope&gt;test&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;io.springfox&lt;/groupId&gt;
      &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
      &lt;version&gt;2.9.2&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;io.springfox&lt;/groupId&gt;
      &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
      &lt;version&gt;2.6.1&lt;/version&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddSwaggerConfigClass">Add Swagger Config Class</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
@EnableSwagger2
public class SwaggerConfig
{
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.any())
                .paths(PathSelectors.any())
                .build();
    }
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-CreateEntityObjects:User,Book,andUserBookMap">Create Entity Objects: <code>User</code>, <code>Book</code>, and <code>UserBookMap</code></h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>User.java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Book.java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>UserBookMap.java</strong></p></th></tr><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class User extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int ID;
    private String name;
    private String type;</pre>
</div></div></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class Book extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int ID;
    private String title;
    private String author;</pre>
</div></div></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class UserBookMap extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int ID;
    private int userId;
    private int bookId;</pre>
</div></div></td></tr></tbody></table></div><p>Use features of your IDE to generate <code>getters/setters</code> and <code>toString</code> methods for these classes.</p><h2 id="LibraryApplicationExample-CreateRepositoryObjectsfortheEntityObjects">Create Repository Objects for the Entity Objects</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 259.0px;"/><col style="width: 499.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>UserRepository.java</strong></p></th><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface UserRepository extends JpaRepository&lt;User, Integer&gt;
{
}</pre>
</div></div></td></tr><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BookRepository.java</strong></p></th><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface BookRepository extends JpaRepository&lt;Book, Integer&gt;
{
}</pre>
</div></div></td></tr><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>UserBookMapRepository.java</strong></p></th><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface UserBookMapRepository extends JpaRepository&lt;UserBookMap, Integer&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-Createanin-memoryDatabase">Create an in-memory Database</h2><p>Add properties to <code>application.properties</code> file to initialize an in-memory H2 database with JDBC URL Connection of &quot;<code>jdbc:h2:mem:db</code>&quot;</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.jpa.show-sql=true
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:db</pre>
</div></div></td></tr></tbody></table></div><p>Pump data into the in-memory database.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">-- USER
INSERT INTO USER(ID, name, type) VALUES(1, &#39;nick&#39;, &#39;employee&#39;)
INSERT INTO USER(ID, name, type) VALUES(2, &#39;paul&#39;, &#39;student&#39;)
INSERT INTO USER(ID, name, type) VALUES(3, &#39;sam&#39;, &#39;retired&#39;)
INSERT INTO USER(ID, name, type) VALUES(4, &#39;mary&#39;, &#39;employee&#39;)
INSERT INTO USER(ID, name, type) VALUES(5, &#39;jim&#39;, &#39;contractor&#39;)

--BOOK
INSERT INTO BOOK(ID, title, author) VALUES(1, &#39;Tom Sawyer&#39;, &#39;Mark Twain&#39;)
INSERT INTO BOOK(ID, title, author) VALUES(2, &#39;Catch 22&#39;, &#39;Joseph Heller&#39;)
INSERT INTO BOOK(ID, title, author) VALUES(3, &#39;War and Peace&#39;, &#39;Lev Tolstoy&#39;)

--USER-BOOK-MAP
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(1, 1, 1)
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(2, 1, 2)
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(3, 2, 2)
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(4, 2, 3)
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(5, 3, 2)
INSERT INTO USER_BOOK_MAP(ID, USER_ID, BOOK_ID) VALUES(6, 4, 3)</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Test">Test</h3><p>Start this application and navigate to:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 142.0px;"/><col style="width: 616.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/h2-console" class="external-link" rel="nofollow">http://localhost:8080/h2-console</a></p></td></tr><tr><td class="confluenceTd"><p>Response</p></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource image-center" width="340" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_8-49-37.png?version=1&amp;modificationDate=1569588577750&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_8-49-37.png?version=1&amp;modificationDate=1569588577750&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p>Verify data in three tables:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>USER</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BOOK</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>USER-BOOK-MAP</strong></p></th></tr><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-27_8-48-30.png?version=1&amp;modificationDate=1569588510072&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-27_8-48-30.png?version=1&amp;modificationDate=1569588510072&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_8-47-53.png?version=1&amp;modificationDate=1569588473084&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_8-47-53.png?version=1&amp;modificationDate=1569588473084&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-27_8-47-22.png?version=1&amp;modificationDate=1569588442844&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-27_8-47-22.png?version=1&amp;modificationDate=1569588442844&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-CreateControllersandCorrespondingEndPointsforUsersandBookswithHATEOASLinks">Create Controllers and Corresponding EndPoints for Users and Books with HATEOAS Links</h2><p>For time being, our controllers will only provide support for REST GET-ALL and GET-ONE methods.</p><h3 id="LibraryApplicationExample-UserContoller">UserContoller</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RestController
@RepositoryRestController
public class UserController
{
    @Autowired
    private UserRepository userRepository;

    @GetMapping(&quot;/users&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getAll()
    {
        List&lt;User&gt; users = userRepository.findAll().stream()
                .map(u -&gt; {u.add(linkTo(methodOn(getClass()).getAll()).slash( &quot;/&quot; + u.getID()).withSelfRel()); return u;})
                .collect(Collectors.toList());

        Resources&lt;User&gt; resources = new Resources&lt;&gt;(users);
        resources.add(linkTo(methodOn(getClass()).getAll()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/users/{id}&quot;)
    public ResponseEntity&lt;Resource&lt;User&gt;&gt; getOne(@PathVariable(&quot;id&quot;) int id)
    {
        User user = userRepository.findById(id).get();
        Resource&lt;User&gt; resource = new Resource&lt;&gt;(user, linkTo(methodOn(getClass()).getOne(id)).withSelfRel());
        return ResponseEntity.ok(resource);
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-BookController">BookController</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RestController
@RepositoryRestController
public class BookController
{
    @Autowired
    private BookRepository bookRepository;

    @GetMapping(&quot;/books&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getAll()
    {
        List&lt;Book&gt; books = bookRepository.findAll().stream()
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getAll()).slash(&quot;/&quot; + b.getID()).withRel(&quot;self&quot;)); return b;})
                .collect(Collectors.toList());

        Resources&lt;Book&gt; resources = new Resources&lt;&gt;(books);
        resources.add(linkTo(methodOn(getClass()).getAll()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/books/{id}&quot;)
    public  ResponseEntity&lt;Resource&lt;Book&gt;&gt;  getOne(@PathVariable(&quot;id&quot;) int id)
    {
        Book book = bookRepository.findById(id).get();
        Resource&lt;Book&gt; resource = new Resource&lt;&gt;(book, linkTo(methodOn(getClass()).getOne(id)).withSelfRel());
        return ResponseEntity.ok(resource);
    }
}
</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Test.1">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 277.0px;"/><col style="width: 683.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;users&quot; : [ {
      &quot;name&quot; : &quot;nick&quot;,
      &quot;type&quot; : &quot;employee&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;paul&quot;,
      &quot;type&quot; : &quot;student&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;sam&quot;,
      &quot;type&quot; : &quot;retired&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;mary&quot;,
      &quot;type&quot; : &quot;employee&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;jim&quot;,
      &quot;type&quot; : &quot;contractor&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users&quot;
    }
  }
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books" class="external-link" rel="nofollow">http://localhost:8080/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;books&quot; : [ {
      &quot;title&quot; : &quot;Tom Sawyer&quot;,
      &quot;author&quot; : &quot;Mark Twain&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
        }
      }
    }, {
      &quot;title&quot; : &quot;Catch 22&quot;,
      &quot;author&quot; : &quot;Joseph Heller&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
        }
      }
    }, {
      &quot;title&quot; : &quot;War and Peace&quot;,
      &quot;author&quot; : &quot;Lev Tolstoy&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/books&quot;
    }
  }
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users/1" class="external-link" rel="nofollow">http://localhost:8080/users/1</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;name&quot; : &quot;nick&quot;,
  &quot;type&quot; : &quot;employee&quot;,
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    }
  }
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/1" class="external-link" rel="nofollow">http://localhost:8080/books/1</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;title&quot; : &quot;Tom Sawyer&quot;,
  &quot;author&quot; : &quot;Mark Twain&quot;,
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h2 id="LibraryApplicationExample-Displaythe&quot;ID&quot;fieldintheJSONResponse">Display the &quot;ID&quot; field in the JSON Response</h2><p>From the previous display, note that the &quot;ID&quot; field from User and Book Entity objects is not displayed in the output. To make this field appear, we need to extend Spring <code>RepositoryRestConfigurerAdapter</code> class.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
public class RestConfigAdapter extends RepositoryRestConfigurerAdapter
{
    @Autowired
    private EntityManager entityManager;

    @Override
    public void configureRepositoryRestConfiguration(RepositoryRestConfiguration config) 
    {
        config.exposeIdsFor(entityManager.getMetamodel().getEntities().stream()
                .map(e -&gt; e.getJavaType()).collect(Collectors.toList()).toArray(new Class[0]));
    }
}</pre>
</div></div></td></tr></tbody></table></div><p>Unfortunately, adding this configuration class will not be enough. For some reason, Spring does not recognize Entity object fields whose name is &quot;ID&quot;. Thus, we also need to refactor our Entity object to change the name of the ID field:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>User.java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Book.java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>UserBookMap.java</strong></p></th></tr><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class User extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int userId;</pre>
</div></div><p>...</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class Book extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int bookId;</pre>
</div></div><p>...</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class UserBookMap extends ResourceSupport
{
    @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int userBookId;</pre>
</div></div><p>...</p></td></tr></tbody></table></div><p>After making this change, the ID field should be displayed in the output:</p><h3 id="LibraryApplicationExample-Test.2">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 250.0px;"/><col style="width: 710.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;users&quot; : [ {
      &quot;userId&quot; : 1,
      &quot;name&quot; : &quot;nick&quot;,
      &quot;type&quot; : &quot;employee&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
        }
      }
    }, {
      &quot;userId&quot; : 2,
      &quot;name&quot; : &quot;paul&quot;,
      &quot;type&quot; : &quot;student&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
        }
      }
    }, {
      &quot;userId&quot; : 3,
      &quot;name&quot; : &quot;sam&quot;,
      &quot;type&quot; : &quot;retired&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
        }
      }
    }, {
      &quot;userId&quot; : 4,
      &quot;name&quot; : &quot;mary&quot;,
      &quot;type&quot; : &quot;employee&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
        }
      }
    }, {
      &quot;userId&quot; : 5,
      &quot;name&quot; : &quot;jim&quot;,
      &quot;type&quot; : &quot;contractor&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users&quot;
    }
  }
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books" class="external-link" rel="nofollow">http://localhost:8080/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;books&quot; : [ {
      &quot;bookId&quot; : 1,
      &quot;title&quot; : &quot;Tom Sawyer&quot;,
      &quot;author&quot; : &quot;Mark Twain&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
        }
      }
    }, {
      &quot;bookId&quot; : 2,
      &quot;title&quot; : &quot;Catch 22&quot;,
      &quot;author&quot; : &quot;Joseph Heller&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
        }
      }
    }, {
      &quot;bookId&quot; : 3,
      &quot;title&quot; : &quot;War and Peace&quot;,
      &quot;author&quot; : &quot;Lev Tolstoy&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/books&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-HideNameofEntityObjects">Hide Name of Entity Objects</h2><p>Our current response contains the name of our Entity objects, for example:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Users</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Books</strong></p></th></tr><tr><td class="confluenceTd"><p><code>{ &quot;_embedded&quot; : { &quot;users&quot; : [ { &quot;userId&quot; : 1, &quot;name&quot; : &quot;nick&quot;, &quot;type&quot; : &quot;employee&quot;, &quot;_links&quot; : { &quot;self&quot; : { &quot;href&quot; : &quot;http://localhost:8080/users/1&quot; } } }</code></p></td><td class="confluenceTd"><p><code>{ &quot;_embedded&quot; : { &quot;books&quot; : [ { &quot;bookId&quot; : 1, &quot;title&quot; : &quot;Tom Sawyer&quot;, &quot;author&quot; : &quot;Mark Twain&quot;, &quot;_links&quot; : { &quot;self&quot; : { &quot;href&quot; : &quot;http://localhost:8080/books/1&quot; } } }</code></p></td></tr></tbody></table></div><p>This may be perfectly fine. However, we may want to hide the name of the Entity object from users of our API.</p><p>We can hide names of entity objects by adding a property to application.properties file. We will add two properties: one to hide the name of the entity object and the other to suppress display of link attributes whose values are null.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
spring.data.rest.defaultMediaType=application/json
spring.jackson.default-property-inclusion=NON_NULL</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Test.3">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 272.0px;"/><col style="width: 688.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Display</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/users&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;self&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  },</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books" class="external-link" rel="nofollow">http://localhost:8080/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/books&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;bookId&quot; : 1,
    &quot;title&quot; : &quot;Tom Sawyer&quot;,
    &quot;author&quot; : &quot;Mark Twain&quot;,
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;self&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    } ]
  },</pre>
</div></div></td></tr></tbody></table></div><p>Note that the name of the entity object now appears as &quot;content&quot;. Of course we always know whether we are looking at Book or User objects by virtue of an endpoint name.</p><h1 id="LibraryApplicationExample-Add&quot;All&quot;HATEOASLinkstoDisplayofIndividualItems">Add &quot;All&quot; HATEOAS Links to Display of Individual Items</h1><p>Note the current response for GET-ONE User:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 220.0px;"/><col style="width: 740.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p>localhost:8080/users/1</p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;userId&quot;: 1,</code><br/><code> &quot;name&quot;: &quot;nick&quot;,</code><br/><code> &quot;type&quot;: &quot;employee&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;self&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/1&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code>}</code></p></td></tr></tbody></table></div><p>There are a couple of things that are wrong with this response:</p><ol><li><p>We do not need to display the &quot;self&quot; link since it has the same value as the request.</p></li><li><p>It might be useful to display the &quot;all&quot; link to return to display of all users.</p></li></ol><p>We will change implementation of GET-ONE in <code>UserController/BookController</code> classes to provide desired output:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@GetMapping(&quot;/users/{id}&quot;)
public ResponseEntity&lt;Resource&lt;User&gt;&gt; getOne(@PathVariable(&quot;id&quot;) int id)
{
    Optional&lt;User&gt; userOptional = userRepository.findById(id);
    if(!userOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    User user = userOptional.get();
    Resource&lt;User&gt; resource = new Resource&lt;&gt;(user);
    ControllerLinkBuilder linkTo = linkTo(methodOn(this.getClass()).getAll());
    resource.add(linkTo.withRel(&quot;all-users&quot;));
    return ResponseEntity.ok(resource);
}</pre>
</div></div></td></tr></tbody></table></div><p>Now, when we check response for a single User/Book item, we see:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 316.0px;"/><col style="width: 644.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p><code>http://localhost:8080/books/1</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;bookId&quot;: 1,</code><br/><code> &quot;title&quot;: &quot;Tom Sawyer&quot;,</code><br/><code> &quot;author&quot;: &quot;Mark Twain&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;all-books&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code>}</code></p></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-ProvideLocationResponseonthePOSTCommand"><br/>Provide Location Response on the POST Command</h2><p>Current implementation of the POST command for User and Book objects return the Entitiy object, for example:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/users&quot;)
public User createUser(@Valid @RequestBody User user)
{
    return userRepository.save(user);
}</pre>
</div></div></td></tr></tbody></table></div><p>When we execute command to POST a new user, for example:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-30_11-52-45.png?version=1&amp;modificationDate=1569858765329&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-30_11-52-45.png?version=1&amp;modificationDate=1569858765329&amp;api=v2" loading="lazy"></span><p>Response comes back with a status of 200:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-30_11-53-34.png?version=1&amp;modificationDate=1569858814427&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-30_11-53-34.png?version=1&amp;modificationDate=1569858814427&amp;api=v2" loading="lazy"></span><p>Rather than returning the User Entity object, we should return the URI of the newly created object and the HTTP Status should be 201 instead of 200.</p><p>We modify POST method to build the response URI and return it instead of the Entity object:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/users&quot;)
public ResponseEntity&lt;Object&gt; createUser(@Valid @RequestBody User user)
{
    User savedUser = userRepository.save(user);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(savedUser.getUserId()).toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><p>When we insert the new User using Postman, we can observe HTTP Status 201 and view the location URI from the Headers;</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 216.0px;"/><col style="width: 744.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-30_12-17-20.png?version=1&amp;modificationDate=1569860240695&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/603211970/image2019-9-30_12-17-20.png?version=1&amp;modificationDate=1569860240695&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-30_12-17-34.png?version=1&amp;modificationDate=1569860254104&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-30_12-17-34.png?version=1&amp;modificationDate=1569860254104&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p><br/></p><h2 id="LibraryApplicationExample-ReturnCorrectStatusWhenUserisNotFound">Return Correct Status When User is Not Found</h2><p>So far, we only executed GET commands for User/Book objects that exist in our in-memory database. What should we return when we query for an unknown user:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 112.0px;"/><col style="width: 848.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p><code>localhost:8080/users/9</code></p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-09-30T16:35:09.594+0000&quot;,</code><br/><code> &quot;status&quot;: 500,</code><br/><code> &quot;error&quot;: &quot;Internal Server Error&quot;,</code><br/><code> &quot;message&quot;: &quot;No value present&quot;</code></p><p><code>}</code></p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-ImplementExceptionHandling">Implement Exception Handling</h3><p>We will create new Exception classes for Not-Found conditions and decorate it with <code>@ResponseStatus(HttpStatus.NOT_FOUND)</code> annotation.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@ResponseStatus(HttpStatus.NOT_FOUND)
public class NotFoundException extends RuntimeException
{
    public NotFoundException(String message)
    {
        super(message);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p>In the <code>UserController/BookController</code> classes, we modify the GET-ONE method to throw this exception for out-of-range ids:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@GetMapping(&quot;/users/{id}&quot;)
public ResponseEntity&lt;Resource&lt;User&gt;&gt; getOne(@PathVariable(&quot;id&quot;) int id)
{
    Optional&lt;User&gt; userOptional = userRepository.findById(id);
    if(!userOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    User user = userOptional.get();
    Resource&lt;User&gt; resource = new Resource&lt;&gt;(user, linkTo(methodOn(getClass()).getOne(id)).withSelfRel());
    return ResponseEntity.ok(resource);
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-TestwithPostman">Test with Postman</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 175.0px;"/><col style="width: 785.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><p><code>localhost:8080/users/9</code></p></td></tr><tr><td class="confluenceTd"><p>Response</p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-09-30T17:00:58.627+0000&quot;,</code><br/><code> &quot;status&quot;: 404,</code><br/><code> &quot;error&quot;: &quot;Not Found&quot;,</code><br/><code> &quot;message&quot;: &quot;id-9&quot;</code></p><p><code>}</code></p></td></tr></tbody></table></div><p><br/></p><h2 id="LibraryApplicationExample-CreateCustomExceptionHandlingApplicabletoallControllers">Create Custom Exception Handling Applicable to all Controllers</h2><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class ExceptionResponse
{
    private Date timestamp;
    private String message;
    private String details;

    public ExceptionResponse(Date timestamp, String message, String details) {
        this.timestamp = timestamp;
        this.message = message;
        this.details = details;
    }

    public Date getTimestamp() {
        return timestamp;
    }

    public String getMessage() {
        return message;
    }

    public String getDetails() {
        return details;
    }
}


</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-ProvideImplementationofResponseEntityExceptionHandler">Provide Implementation of ResponseEntityExceptionHandler</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@ControllerAdvice
@RestController
public class CustomizedResponseEntityExceptionHandler extends ResponseEntityExceptionHandler
{

    @ExceptionHandler(Exception.class)
    public final ResponseEntity&lt;Object&gt; handleAllExceptions(Exception ex, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(new Date(), ex.getMessage(), request.getDescription(false));
        return new ResponseEntity(exceptionResponse, HttpStatus.INTERNAL_SERVER_ERROR);
    }

    @ExceptionHandler(NotFoundException.class)
    public final ResponseEntity&lt;Object&gt; handleUserNotFoundException(NotFoundException ex, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(new Date(), ex.getMessage(),
                request.getDescription(false));
        return new ResponseEntity(exceptionResponse, HttpStatus.NOT_FOUND);
    }

    @Override
    protected ResponseEntity&lt;Object&gt; handleMethodArgumentNotValid(MethodArgumentNotValidException ex,
                                                                  HttpHeaders headers, HttpStatus status, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(new Date(), &quot;Validation Failed&quot;,
                ex.getBindingResult().toString());
        return new ResponseEntity(exceptionResponse, HttpStatus.BAD_REQUEST);
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-TestwithPostman.1">Test with Postman</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 279.0px;"/><col style="width: 681.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><code>localhost:8080/users/9</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-09-30T18:10:21.567+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;id-9&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/users/9&quot;</code><br/><code>}</code></p></td></tr><tr><td class="confluenceTd"><p><code>localhost:8080/books/9</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-09-30T18:11:09.740+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;id-9&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/books/9&quot;</code><br/><code>}</code></p></td></tr></tbody></table></div><p><br/></p><p><br/></p><h1 id="LibraryApplicationExample-AddSupportforEmbeddedObjects">Add Support for Embedded Objects</h1><p>Now to the interesting part.</p><p>We would like to display a list of books that are associated with some user and a list of users that are associated with some book. In addition, we also want to provide the summary information by both users and books.</p><p>To support this feature, we had created a USER_BOOK_MAP table and associated Entity, Repository, and Controller objects.</p><p>In this section, we will be implementing the <code>UserBookMapController</code> object.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RestController
@RepositoryRestController
public class UserBookMapController
{
    @Autowired
    private UserRepository userRepository;
    @Autowired
    private BookRepository bookRepository;
    @Autowired
    UserBookMapRepository userBookMapRepository;

    @GetMapping(&quot;/users/books&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;?&gt;&gt;&gt; getAllUsersBooks()
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
        Set&lt;Integer&gt; processedUserIdsSet = new HashSet&lt;&gt;();

        List&lt;UserBookMap&gt; userBookMapList = userBookMapRepository.findAll();
        for(UserBookMap userBookMap : userBookMapList)
        {
            int userId = userBookMap.getBookId();
            if(processedUserIdsSet.add(userId))
            {
                User user = userRepository.findById(userId).get();
                Resource&lt;User&gt; userResource = new Resource&lt;&gt;(user, createUserLink(userId));
                resourceResult.add(userResource);

                List&lt;UserBookMap&gt; booksForUser = userBookMapRepository.findAll().stream().filter(u -&gt; u.getUserId() == userId).collect(Collectors.toList());
                for(UserBookMap books : booksForUser)
                {
                    int bookId = books.getBookId();
                    Book book = bookRepository.findById(bookId).get();
                    Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(bookId));
                    resourceResult.add(bookResource);
                }
            }
        }

        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllUsersBooks()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/users/{userId}/books&quot;)
    ResponseEntity&lt;?&gt; getAllBooksForUser(@PathVariable(&quot;userId&quot;) int userId)
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        User user = userRepository.findById(userId).get();
        Resource&lt;User&gt; userResource = new Resource&lt;&gt;(user, createUserLink(userId));
        resourceResult.add(userResource);

        List&lt;UserBookMap&gt; userBookMapFilteredList = userBookMapRepository.findAll().stream().filter(u -&gt; u.getUserId() == userId).collect(Collectors.toList());
        for(UserBookMap userBookMap : userBookMapFilteredList)
        {
            int bookId = userBookMap.getBookId();
            Book book = bookRepository.findById(bookId).get();
            Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(bookId));
            resourceResult.add(bookResource);
        }

        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllBooksForUser(userId)).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/books/users&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;?&gt;&gt;&gt; getAllBooksUsers()
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
        Set&lt;Integer&gt; processedBookIdsSet = new HashSet&lt;&gt;();

        List&lt;UserBookMap&gt; userBookMapList = userBookMapRepository.findAll();
        for(UserBookMap userBookMap : userBookMapList)
        {
            int bookId = userBookMap.getBookId();
            if(processedBookIdsSet.add(bookId))
            {
                Book book = bookRepository.findById(bookId).get();
                Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(bookId));
                resourceResult.add(bookResource);

                List&lt;UserBookMap&gt; usersForBook = userBookMapRepository.findAll().stream().filter(b -&gt; b.getBookId() == bookId).collect(Collectors.toList());
                for(UserBookMap users : usersForBook)
                {
                    int userId = users.getUserId();
                    User user = userRepository.findById(userId).get();
                    Resource&lt;User&gt; userResource = new Resource&lt;&gt;(user, createUserLink(userId));
                    resourceResult.add(userResource);
                }
            }
        }

        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllBooksUsers()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/books/{bookId}/users&quot;)
    ResponseEntity&lt;?&gt; getAllUsersForBook(@PathVariable(&quot;bookId&quot;) int bookId)
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        Book book = bookRepository.findById(bookId).get();
        Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(bookId));
        resourceResult.add(bookResource);

        List&lt;UserBookMap&gt; userBookMapFilteredList = userBookMapRepository.findAll().stream().filter(b -&gt; b.getBookId() == bookId).collect(Collectors.toList());
        for(UserBookMap userBookMap : userBookMapFilteredList)
        {
            int userId = userBookMap.getUserId();
            User user = userRepository.findById(userId).get();
            Resource&lt;User&gt; userResource = new Resource&lt;&gt;(user, createUserLink(userId));
            resourceResult.add(userResource);
        }

        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllUsersForBook(bookId)).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    private Link createUserLink(int userId)
    {
        return linkTo(methodOn(UserController.class).getOne(userId)).withRel(&quot;user&quot;);
    }

    private Link createBookLink(int bookId)
    {
        return linkTo(methodOn(BookController.class).getOne(bookId)).withRel(&quot;book&quot;);
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Test.4">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 327.0px;"/><col style="width: 633.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Display</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users/books" class="external-link" rel="nofollow">http://localhost:8080/users/books</a></p></td><td class="confluenceTd"><p>...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&quot;content&quot; : [ {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  }, {
    &quot;bookId&quot; : 1,
    &quot;title&quot; : &quot;Tom Sawyer&quot;,
    &quot;author&quot; : &quot;Mark Twain&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    } ]
  }, {
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  }, {
    &quot;userId&quot; : 2,
    &quot;name&quot; : &quot;paul&quot;,
    &quot;type&quot; : &quot;student&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    } ]
  }, {
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  }, {
    &quot;bookId&quot; : 3,
    &quot;title&quot; : &quot;War and Peace&quot;,
    &quot;author&quot; : &quot;Lev Tolstoy&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
    } ]
  },</pre>
</div></div><p>...</p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users/2/books" class="external-link" rel="nofollow">http://localhost:8080/users/2/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/users/2/books&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;userId&quot; : 2,
    &quot;name&quot; : &quot;paul&quot;,
    &quot;type&quot; : &quot;student&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    } ]
  }, {
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  }, {
    &quot;bookId&quot; : 3,
    &quot;title&quot; : &quot;War and Peace&quot;,
    &quot;author&quot; : &quot;Lev Tolstoy&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/users" class="external-link" rel="nofollow">http://localhost:8080/books/users</a></p></td><td class="confluenceTd"><p>...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  }, {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  }, {
    &quot;userId&quot; : 2,
    &quot;name&quot; : &quot;paul&quot;,
    &quot;type&quot; : &quot;student&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    } ]
  }, {
    &quot;userId&quot; : 3,
    &quot;name&quot; : &quot;sam&quot;,
    &quot;type&quot; : &quot;retired&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
    } ]
  },</pre>
</div></div><p>...</p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/1/users" class="external-link" rel="nofollow">http://localhost:8080/books/1/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/books/1/users&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;bookId&quot; : 1,
    &quot;title&quot; : &quot;Tom Sawyer&quot;,
    &quot;author&quot; : &quot;Mark Twain&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    } ]
  }, {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationExample-ProvideLinksOnlyforEmbeddedObjects">Provide Links Only for Embedded Objects</h2><p>One of the problems with above responses is that they are too verbose. If we want to see information for all users with books, our responses display detailed information for each user as well as detailed information for each book. Since HATEOAS provides us with an easy way to navigate between our Entity objects, we may wish to limit the display of embedded objects to links only. To make this happen, we only need to simplify existing code:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@GetMapping(&quot;/users/books&quot;)
public ResponseEntity&lt;Resources&lt;Resource&lt;?&gt;&gt;&gt; getAllUsersBooks()
{
    List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
    Set&lt;Integer&gt; processedUserIdsSet = new HashSet&lt;&gt;();
    List&lt;UserBookMap&gt; userBookMapList = userBookMapRepository.findAll();
    for(UserBookMap userBookMap : userBookMapList)
    {
        int userId = userBookMap.getBookId();
        if(processedUserIdsSet.add(userId))
        {
            User user = userRepository.findById(userId).get();
            Resource&lt;User&gt; userResource = new Resource&lt;&gt;(user, createUserLink(userId));
            resourceResult.add(userResource);
            List&lt;UserBookMap&gt; booksForUser = userBookMapRepository.findAll().stream().filter(u -&gt; u.getUserId() == userId).collect(Collectors.toList());
            for(UserBookMap books : booksForUser)
            {
                int bookId = books.getBookId();
                userResource.add(createBookLink(bookId));
            }
        }
    }
    Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllUsersBooks()).withSelfRel());
    return ResponseEntity.ok(resources);
}
...
@GetMapping(&quot;/books/users&quot;)
public ResponseEntity&lt;Resources&lt;Resource&lt;?&gt;&gt;&gt; getAllBooksUsers()
{
    List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
    Set&lt;Integer&gt; processedBookIdsSet = new HashSet&lt;&gt;();
    List&lt;UserBookMap&gt; userBookMapList = userBookMapRepository.findAll();
    for(UserBookMap userBookMap : userBookMapList)
    {
        int bookId = userBookMap.getBookId();
        if(processedBookIdsSet.add(bookId))
        {
            Book book = bookRepository.findById(bookId).get();
            Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(bookId));
            resourceResult.add(bookResource);
            List&lt;UserBookMap&gt; usersForBook = userBookMapRepository.findAll().stream().filter(b -&gt; b.getBookId() == bookId).collect(Collectors.toList());
            for(UserBookMap users : usersForBook)
            {
                int userId = users.getUserId();
                bookResource.add(createUserLink(userId));
            }
        }
    }
    Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getAllBooksUsers()).withSelfRel());
    return ResponseEntity.ok(resources);
}
...</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-Test.5">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 297.0px;"/><col style="width: 663.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Display</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users/books" class="external-link" rel="nofollow">http://localhost:8080/users/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/users/books&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  }, {
    &quot;userId&quot; : 2,
    &quot;name&quot; : &quot;paul&quot;,
    &quot;type&quot; : &quot;student&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
    } ]
  }, {
    &quot;userId&quot; : 3,
    &quot;name&quot; : &quot;sam&quot;,
    &quot;type&quot; : &quot;retired&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/users" class="external-link" rel="nofollow">http://localhost:8080/books/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/books/users&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;bookId&quot; : 1,
    &quot;title&quot; : &quot;Tom Sawyer&quot;,
    &quot;author&quot; : &quot;Mark Twain&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  }, {
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
    } ]
  }, {
    &quot;bookId&quot; : 3,
    &quot;title&quot; : &quot;War and Peace&quot;,
    &quot;author&quot; : &quot;Lev Tolstoy&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/3&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    }, {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr></tbody></table></div><p>If we choose to drill down on a specific user, we will continue to display detail information about books, for example:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 249.0px;"/><col style="width: 709.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Display</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users/1/books" class="external-link" rel="nofollow">http://localhost:8080/users/1/books</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot; : [ {
    &quot;rel&quot; : &quot;self&quot;,
    &quot;href&quot; : &quot;http://localhost:8080/users/1/books&quot;
  } ],
  &quot;content&quot; : [ {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    } ]
  }, {
    &quot;bookId&quot; : 1,
    &quot;title&quot; : &quot;Tom Sawyer&quot;,
    &quot;author&quot; : &quot;Mark Twain&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    } ]
  }, {
    &quot;bookId&quot; : 2,
    &quot;title&quot; : &quot;Catch 22&quot;,
    &quot;author&quot; : &quot;Joseph Heller&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddTitleAttributestotheLink">Add Title Attributes to the Link</h3><p>Let us again look at one of the items returned from <code>localhost:8080/users/books</code> GET request:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">[ {
    &quot;userId&quot; : 1,
    &quot;name&quot; : &quot;nick&quot;,
    &quot;type&quot; : &quot;employee&quot;,
    &quot;links&quot; : [ ],
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;user&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/1&quot;
    }, {
      &quot;rel&quot; : &quot;book&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/books/2&quot;
    }
]</pre>
</div></div></td></tr></tbody></table></div><p>We see that userId=1 has 2 books. To find out information about books held by this user we need to drill down to each book. It would be helpful if the link could display additional information to provide a hint. This can be done with a slight code modification:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">private Link createBookLink(int bookId, String title)
{
    return linkTo(methodOn(LibraryController.class).getOneBook(bookId)).withRel(&quot;book&quot;).withTitle(title);
}</pre>
</div></div></td></tr></tbody></table></div><p>After this change, the title of the book appears as one of the link attributes:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">[
 {
 &quot;userId&quot;: 1,
 &quot;name&quot;: &quot;nick&quot;,
 &quot;type&quot;: &quot;employee&quot;,
 &quot;links&quot;: [
 {
 &quot;rel&quot;: &quot;user&quot;,
 &quot;href&quot;: &quot;http://localhost:8080/users/1&quot;
 },
 {
 &quot;rel&quot;: &quot;book&quot;,
 &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;,
 &quot;title&quot;: &quot;Tom Sawyer&quot;
 },
 {
 &quot;rel&quot;: &quot;book&quot;,
 &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;,
 &quot;title&quot;: &quot;Catch 22&quot;
 }
]</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><p><br/></p><h2 id="LibraryApplicationExample-AddotherRESTCommandstoEntityObjects">Add other REST Commands to Entity Objects</h2><p>So far, we only supported GET-ALL and GET-ONE Rest Commands for User and Book objects. In this section, we will add POST, PUT, and DELETE commands.</p><h3 id="LibraryApplicationExample-AddPOST,PUT,andDELETECommandstoUserEntityObject">Add POST, PUT, and DELETE Commands to User Entity Object</h3><p>Modify <code>UserController</code> object:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@PostMapping(&quot;/users&quot;)
public ResponseEntity&lt;Object&gt; createUser(@Valid @RequestBody User user)
{
    User savedUser = userRepository.save(user);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(savedUser.getUserId()).toUri();
    return ResponseEntity.created(location).build();
}
@PutMapping(&quot;/users&quot;)
public User updateUser(@Valid @RequestBody User user)
{
    User existingUser = userRepository.findById(user.getUserId()).get();
    if(existingUser != null)
    {
        existingUser.setName(user.getName());
        existingUser.setType(user.getType());
        user = existingUser;
    }
    return userRepository.save(user);
}
@DeleteMapping(&quot;/users/{id}&quot;)
public void deleteUser(@PathVariable(&quot;id&quot;) int id)
{
    Optional&lt;User&gt; userOptional = userRepository.findById(id);
    if(!userOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    userRepository.deleteById(id);
}
...</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-UsePostmantoTestPOSTCommand">Use Postman to Test POST Command</h3><p>Select the POST Command:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-50-36.png?version=1&amp;modificationDate=1569603036695&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-50-36.png?version=1&amp;modificationDate=1569603036695&amp;api=v2" loading="lazy"></span><p>Specify body:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-51-10.png?version=1&amp;modificationDate=1569603070958&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-51-10.png?version=1&amp;modificationDate=1569603070958&amp;api=v2" loading="lazy"></span><p>Use GET-ALL to check for new user</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><p>...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">}, {
    &quot;userId&quot; : 6,
    &quot;name&quot; : &quot;joe&quot;,
    &quot;type&quot; : &quot;unemployed&quot;,
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;self&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/6&quot;
    } ]
  } ]
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-UsePostmantoTestPUTCommand">Use Postman to Test PUT Command</h3><p>Select the PUT command:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-56-32.png?version=1&amp;modificationDate=1569603392262&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-56-32.png?version=1&amp;modificationDate=1569603392262&amp;api=v2" loading="lazy"></span><p>Specify body:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-57-0.png?version=1&amp;modificationDate=1569603420548&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_12-57-0.png?version=1&amp;modificationDate=1569603420548&amp;api=v2" loading="lazy"></span><p>Use GET-ALL to check for modified user</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><p>...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence"> {
    &quot;userId&quot; : 2,
    &quot;name&quot; : &quot;paul&quot;,
    &quot;type&quot; : &quot;consultant&quot;,
    &quot;links&quot; : [ {
      &quot;rel&quot; : &quot;self&quot;,
      &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
    } ]
  }, </pre>
</div></div><p>...</p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-UsePostmantoTestDELETECommand">Use Postman to Test DELETE Command</h3><p>Select the DELETE command:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_13-4-49.png?version=1&amp;modificationDate=1569603889134&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_13-4-49.png?version=1&amp;modificationDate=1569603889134&amp;api=v2" loading="lazy"></span><p>Specify body:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_13-5-14.png?version=1&amp;modificationDate=1569603914718&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_13-5-14.png?version=1&amp;modificationDate=1569603914718&amp;api=v2" loading="lazy"></span><p>View response to verify that User with id=1 has been removed:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><p><code>[</code><br/><code> {</code><br/><code> &quot;userId&quot;: 2,</code><br/><code> &quot;name&quot;: &quot;paul&quot;,</code><br/><code> &quot;type&quot;: &quot;student&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;userId&quot;: 3,</code><br/><code> &quot;name&quot;: &quot;sam&quot;,</code><br/><code> &quot;type&quot;: &quot;retired&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;userId&quot;: 4,</code><br/><code> &quot;name&quot;: &quot;mary&quot;,</code><br/><code> &quot;type&quot;: &quot;employee&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;userId&quot;: 5,</code><br/><code> &quot;name&quot;: &quot;jim&quot;,</code><br/><code> &quot;type&quot;: &quot;contractor&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> }</code><br/><code>]</code></p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddPOST,PUT,andDELETECommandstoBookEntityObject">Add POST, PUT, and DELETE Commands to Book Entity Object</h3><p>Apply same logic as above.</p><h3 id="LibraryApplicationExample-AddPOST,PUT,andDELETECommandstoUserBookMapEntityObject">Add POST, PUT, and DELETE Commands to UserBookMap Entity Object</h3><p>Prior to adding these operations, we will need to make a slight change to the UserBookMap object by adding a constructor. Once we add a constructor to an Entity object, we mist also provide a default constructor:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
public UserBookMap(int userId, int bookId)
{
    this.userId = userId;
    this.bookId = bookId;
}
protected UserBookMap()
{
}
...</pre>
</div></div></td></tr></tbody></table></div><p><strong>We should also note</strong> that <code>UserBookMap</code> contains a mapping of <code>User</code> and <code>Book</code> entity objects. We will not be creating new <code>User</code> or <code>Book</code> entity objects but rather create, modify, or delete mapping between these objects. To create new User and/or Book entity objects, we use POST commands with endpoints <code>/users</code> and <code>/books</code>.</p><p>Modify <code>UserBookMapController</code> class to add a POST Command:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@PostMapping(&quot;/users/{userId}/books/{bookId}&quot;)
public ResponseEntity&lt;?&gt; addNewBookToUser(@PathVariable(&quot;userId&quot;) int userId, @PathVariable(&quot;bookId&quot;) int bookId)
{
    Optional&lt;UserBookMap&gt; userBookMapOptional = userBookMapRepository.findAll().stream().filter(m -&gt; m.getBookId() == bookId &amp;&amp; m.getUserId() == userId).findFirst();
    if(!userBookMapOptional.isPresent())
    {
        UserBookMap userBookMap = new UserBookMap(userId, bookId);
        userBookMapRepository.save(userBookMap);
    }
    return getAllBooksForUser(userId);
}
...
@PostMapping(&quot;/books/{bookId}/users/{userId}&quot;)
public ResponseEntity&lt;?&gt; addNewUserToBook(@PathVariable(&quot;bookId&quot;) int bookId, @PathVariable(&quot;userId&quot;) int userId)
{
    Optional&lt;UserBookMap&gt; userBookMapOptional = userBookMapRepository.findAll().stream().filter(m -&gt; m.getBookId() == bookId &amp;&amp; m.getUserId() == userId).findFirst();
    if(!userBookMapOptional.isPresent())
    {
        UserBookMap userBookMap = new UserBookMap(userId, bookId);
        userBookMapRepository.save(userBookMap);
    }
    return getAllUsersForBook(userId);
}
...</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-UsePostmantoTestPOSTCommand.1">Use Postman to Test POST Command</h3><p>Execute GET command to observe the current state:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p>localhost:8080/users/books</p></td><td class="confluenceTd"><p><code>&quot;content&quot;: [</code><br/><code> {</code><br/><code> &quot;userId&quot;: 1,</code><br/><code> &quot;name&quot;: &quot;nick&quot;,</code><br/><code> &quot;type&quot;: &quot;employee&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/1&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;userId&quot;: 2,</code><br/><code> &quot;name&quot;: &quot;paul&quot;,</code><br/><code> &quot;type&quot;: &quot;student&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/2&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;userId&quot;: 3,</code><br/><code> &quot;name&quot;: &quot;sam&quot;,</code><br/><code> &quot;type&quot;: &quot;retired&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/3&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> }</code><br/><code> ]</code></p></td></tr></tbody></table></div><p>Note that user (id=2) has one book (id=3)</p><p>Use the POST Command to add new mapping</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_14-58-10.png?version=1&amp;modificationDate=1569610690446&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_14-58-10.png?version=1&amp;modificationDate=1569610690446&amp;api=v2" loading="lazy"></span><p>Note the response and observe that this User now also has book with id=1</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><p><code>&quot;content&quot;: [</code><br/><code> {</code><br/><code> &quot;userId&quot;: 3,</code><br/><code> &quot;name&quot;: &quot;sam&quot;,</code><br/><code> &quot;type&quot;: &quot;retired&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/3&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;bookId&quot;: 2,</code><br/><code> &quot;title&quot;: &quot;Catch 22&quot;,</code><br/><code> &quot;author&quot;: &quot;Joseph Heller&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;bookId&quot;: 1,</code><br/><code> &quot;title&quot;: &quot;Tom Sawyer&quot;,</code><br/><code> &quot;author&quot;: &quot;Mark Twain&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> }</code><br/><code> ]</code></p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddtheDELETECommand">Add the DELETE Command</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@DeleteMapping(&quot;/users/{userId}/books/{bookId}&quot;)
public ResponseEntity&lt;?&gt; deleteBookFromUser(@PathVariable(&quot;userId&quot;) int userId, @PathVariable(&quot;bookId&quot;) int bookId)
{
    Optional&lt;UserBookMap&gt; userBookMapOptional = userBookMapRepository.findAll().stream().filter(m -&gt; m.getBookId() == bookId &amp;&amp; m.getUserId() == userId).findFirst();
    if(userBookMapOptional.isPresent())
    {
        userBookMapRepository.delete(userBookMapOptional.get());
    }
    return getAllBooksForUser(userId);
}
...
@DeleteMapping(&quot;/books/{bookId}/users/{userId}&quot;)
public ResponseEntity&lt;?&gt; deleteUserFromBook(@PathVariable(&quot;bookId&quot;) int bookId, @PathVariable(&quot;userId&quot;) int userId)
{
    Optional&lt;UserBookMap&gt; userBookMapOptional = userBookMapRepository.findAll().stream().filter(m -&gt; m.getBookId() == bookId &amp;&amp; m.getUserId() == userId).findFirst();
    if(userBookMapOptional.isPresent())
    {
        userBookMapRepository.delete(userBookMapOptional.get());
    }
    return getAllUsersForBook(bookId);
}
...</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationExample-UsePostmantoTesttheDELETECommand">Use Postman to Test the DELETE Command</h3><p>Select the DELETE command:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_14-42-14.png?version=1&amp;modificationDate=1569609734579&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_14-42-14.png?version=1&amp;modificationDate=1569609734579&amp;api=v2" loading="lazy"></span><p>Observe the response:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;self&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/1/books&quot;</code><br/><code> }</code><br/><code> ],</code><br/><code> &quot;content&quot;: [</code><br/><code> {</code><br/><code> &quot;userId&quot;: 1,</code><br/><code> &quot;name&quot;: &quot;nick&quot;,</code><br/><code> &quot;type&quot;: &quot;employee&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/1&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;bookId&quot;: 1,</code><br/><code> &quot;title&quot;: &quot;Tom Sawyer&quot;,</code><br/><code> &quot;author&quot;: &quot;Mark Twain&quot;,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;book&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code> }</code><br/><code> ]</code><br/><code>}</code></p></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-PUTCommandforUserBookMap">PUT Command for UserBookMap</h3><p>We will intentionally not support the PUT Command for UserBookMap entity object because the EndPoint would be too complex and its intention would be unclear. To modify existing UserBookMap object, execute DELETE command followed by POST.</p><h1 id="LibraryApplicationExample-ImplementOne-To-ManyRelationship">Implement One-To-Many Relationship</h1><p>User and Book entity objects demonstrate a many-to-many relationship. Each user can have many books and every book (title) may be help by multiple users. In this section we demonstrate a one-to-many relationship where each User may have one or more phones.</p><h3 id="LibraryApplicationExample-CreatePhoneEntityClass">Create Phone Entity Class</h3><p>This class will be in the <code>ManyToOne</code> relationship with the <code>User</code> Entity object. Make sure not to add <code>User</code> to the <code>toString</code> method to avoid infinite recursion.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class Phone extends ResourceSupport
{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int phoneId;
    @Column(name=&quot;phone_number&quot;)
    private String number;
    private String type;
    @ManyToOne(fetch=FetchType.LAZY)
    @JsonIgnore
    private User user;

    public int getPhoneId() {
        return phoneId;
    }

    public void setPhoneId(int phoneId) {
        this.phoneId = phoneId;
    }

    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    @Override
    public String
    toString() {
        return &quot;Phone{&quot; +
                &quot;phoneId=&quot; + phoneId +
                &quot;, number=&#39;&quot; + number + &#39;\&#39;&#39; +
                &quot;, type=&#39;&quot; + type + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-ModifyUserEntitytoIncludePhone">Modify User Entity to Include Phone</h3><p>A <code>User</code> Entity object will have a <code>OneToMany</code> relationship with <code>Phone</code> objects</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class User extends ResourceSupport
{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;ID&quot;)
    private int userId;
    private String name;
    private String type;
    @OneToMany(mappedBy = &quot;user&quot;)
    private List&lt;Phone&gt; phones;

    public List&lt;Phone&gt; getPhones()
    {
        return phones;
    }
...
}</pre>
</div></div></td></tr></tbody></table></div><p>Do not add the phones object to the <code>toString</code> method to avoid infinite recursion.</p><h3 id="LibraryApplicationExample-CreateaRepositoryClassforPhone">Create a Repository Class for Phone</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface PhoneRepository extends JpaRepository&lt;Phone, Integer&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddPhoneRecords">Add Phone Records </h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
-- PHONE
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(1, &#39;212-456-9876&#39;, &#39;home&#39;, 1)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(2, &#39;201-444-9888&#39;, &#39;mobile&#39;, 1)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(3, &#39;917-751-0947&#39;, &#39;mobile&#39;, 2)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(4, &#39;845-765-0912&#39;, &#39;home&#39;, 3)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(5, &#39;203-754-6387&#39;, &#39;mobile&#39;, 3)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(6, &#39;212-532-1111&#39;, &#39;home&#39;, 4)
INSERT INTO PHONE(ID, phone_number, type, USER_ID) VALUES(7, &#39;201-432-9899&#39;, &#39;mobile&#39;, 5)</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-AddGETandPOSTmethodstoUserControllertoViewandAddPhones">Add GET and POST methods to UserController to View and Add Phones</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@Autowired
private PhoneRepository phoneRepository;
...
@GetMapping(&quot;/users/{id}/phones&quot;)
public ResponseEntity&lt;?&gt; getPhones(@PathVariable int id)
{
    Optional&lt;User&gt; userOptional = userRepository.findById(id);
    if(!userOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    List&lt;Phone&gt; phones = userOptional.get().getPhones();
    Resources&lt;Phone&gt; resources = new Resources&lt;&gt;(phones);
    ControllerLinkBuilder linkTo = linkTo(methodOn(this.getClass()).getOne(id));
    resources.add(linkTo.withRel(&quot;user-&quot; + id));
    return ResponseEntity.ok(resources);
}
...
@PostMapping(&quot;/users/{id}/phones&quot;)
public ResponseEntity&lt;?&gt; createPhones(@PathVariable int id, @RequestBody Phone phone)
{
    Optional&lt;User&gt; userOptional = userRepository.findById(id);
    if(!userOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    User user = userOptional.get();
    phone.setUser(user);
    phoneRepository.save(phone);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(phone.getPhoneId()).toUri();
    return ResponseEntity.created(location).build();
}
...</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationExample-TestwithPostman.2">Test with Postman</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Action</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p>Check Phones for User 1</p></td><td class="confluenceTd"><p><code>GET, http://localhost:8080/users/1/phones</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;user-1&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/users/1&quot;</code><br/><code> }</code><br/><code> ],</code><br/><code> &quot;content&quot;: [</code><br/><code> {</code><br/><code> &quot;phoneId&quot;: 1,</code><br/><code> &quot;number&quot;: &quot;212-456-9876&quot;,</code><br/><code> &quot;type&quot;: &quot;home&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;phoneId&quot;: 2,</code><br/><code> &quot;number&quot;: &quot;201-444-9888&quot;,</code><br/><code> &quot;type&quot;: &quot;mobile&quot;,</code><br/><code> &quot;links&quot;: []</code><br/><code> }</code><br/><code> ]</code><br/><code>}</code></p></td></tr><tr><td class="confluenceTd"><p>Check Phones for non-existent user</p></td><td class="confluenceTd"><p><code>GET, http://localhost:8080/users/6/phones</code></p></td><td class="confluenceTd"><p><br/></p><p><code>Status: 404</code></p><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-10-01T12:37:38.539+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;id-6&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/users/6/phones&quot;</code><br/><code>}</code></p><p><br/></p></td></tr><tr><td class="confluenceTd"><p>Add a phone to a user</p></td><td class="confluenceTd"><p><br/></p><p><code>POST, localhost:8080/users/1/phones</code></p><p><code>{</code><br/><code> &quot;number&quot;: &quot;212-555-1212&quot;,</code><br/><code> &quot;type&quot;: &quot;office&quot;</code><br/><code>}</code></p><p><br/></p></td><td class="confluenceTd"><p><br/></p><p><code>Status: 201Headers: location →http://localhost:8080/users/1/phones/8</code></p><p><br/></p></td></tr><tr><td class="confluenceTd"><p>Try adding phone to non-existent user</p></td><td class="confluenceTd"><p><br/></p><p><code>POST, localhost:8080/users/1/phones</code></p><p><code>{</code><br/><code> &quot;number&quot;: &quot;212-555-1212&quot;,</code><br/><code> &quot;type&quot;: &quot;office&quot;</code><br/><code>}</code></p><p><br/></p></td><td class="confluenceTd"><p><code>Status: 404</code></p></td></tr></tbody></table></div><p><br/></p><h1 id="LibraryApplicationExample-TimeforRefactoring">Time for Refactoring</h1><p>Our little application has three Controller classes: <code>UserController, BookController,</code> and <code>UserBookMapController</code>. It's practical to keep this functionality separated into their own classes. However, this also creates a problem when we look at the display on the Swagger Page.</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_16-33-28.png?version=1&amp;modificationDate=1569616408566&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-9-27_16-33-28.png?version=1&amp;modificationDate=1569616408566&amp;api=v2" loading="lazy"></span><p>We would like all REST API Enpoints to appear together under a single controller.</p><p>We can move code from <code>UserController, BookController, UserBookMapController</code> into services <code>UserService, BookService</code>, and <code>UserBookMapService</code>. Then, we can create another controller, for example, <code>LibraryController</code>, and delegate functionality to the respective services. Now, all REST APIs appear under the same controller:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-10-1_16-24-16.png?version=1&amp;modificationDate=1569961456213&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/603211970/image2019-10-1_16-24-16.png?version=1&amp;modificationDate=1569961456213&amp;api=v2" loading="lazy"></span><p><br/></p><h2 id="LibraryApplicationExample-EnforceReferentialIntegrity"><a href="https://confluence.apg.services.gs.com/display/~gunern/Enforce+Referential+Integrity" class="external-link" rel="nofollow">Enforce Referential Integrity</a></h2><h2 id="LibraryApplicationExample-LibraryApplicationTests"><a href="https://confluence.apg.services.gs.com/display/~gunern/Library+Application+Tests" class="external-link" rel="nofollow">Library Application Tests</a></h2><h2 id="LibraryApplicationExample-AddInstrumentationtoLibraryApplication"><a href="https://confluence.apg.services.gs.com/display/~gunern/Add+Instrumentation+to+Library+Application" class="external-link" rel="nofollow">Add Instrumentation to Library Application</a></h2><h2 id="LibraryApplicationExample-JPQLandCriteriaBuilder"><a href="https://confluence.apg.services.gs.com/display/~gunern/JPQL+and+CriteriaBuilder" class="external-link" rel="nofollow">JPQL and CriteriaBuilder</a></h2><h2 id="LibraryApplicationExample-UseRepositoryforCustomizedQueries"><a href="https://confluence.apg.services.gs.com/display/~gunern/Use+Repository+for+Customized+Queries" class="external-link" rel="nofollow">Use Repository for Customized Queries</a></h2>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
