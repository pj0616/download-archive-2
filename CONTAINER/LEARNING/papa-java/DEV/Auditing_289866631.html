<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Auditing</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Basic_289898911.html">Basic</a></span>
                            </li>
                                                    <li>
                                <span><a href="Library-Application-Example_289866546.html">Library Application Example</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Auditing
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span>, last modified on Apr 20, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="Auditing-HelpfulLinks">Helpful Links</h1><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/290030189.png" data-image-src="attachments/289866631/290030189.png" data-height="148" data-width="499" data-unresolved-comment-count="0" data-linked-resource-id="290030189" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-120750.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="4586790d-bcbd-4692-852b-828742ae417a" data-media-type="file"></span><p>This exercise continues from where <a href="https://confluence.apg.services.gs.com/display/~gunern/Library+Application+Redesign" class="external-link" rel="nofollow">Library Application Redesign</a> left off.</p><h2 id="Auditing-AddEnversandSecurity-CoreDependency">Add Envers and Security-Core Dependency</h2><p><strong>pom.xml</strong></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="initial" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;dependency&gt;
   &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
   &lt;artifactId&gt;hibernate-envers&lt;/artifactId&gt;
   &lt;version&gt;${hibernate.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
   &lt;artifactId&gt;spring-security-core&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div></div></td></tr></tbody></table></div><h2 id="Auditing-AddAuditingforDates:@CreatedDateand@ModifiedDate">Add Auditing for Dates: @CreatedDate and @ModifiedDate</h2><h3 id="Auditing-CreateBaseClass(markedwith@MappedSuperclass)forCreatedDateandLastModifiedDate">Create Base Class (marked with @MappedSuperclass) for CreatedDate and LastModifiedDate</h3><p><strong>entity/BaseEntity.java</strong></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="initial" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity  extends ResourceSupport
{
    @Column(name = &quot;created_date&quot;, nullable = false, updatable = false)
    @CreatedDate
    @JsonIgnore
    @CreationTimestamp
    @Temporal(TemporalType.TIMESTAMP)
    private Date createdDate;
 
    @Column(name = &quot;modified_date&quot;)
    @LastModifiedDate
    @JsonIgnore
    @UpdateTimestamp
    @Temporal(TemporalType.TIMESTAMP)
    private Date modifiedDate;
 
    public Date getCreatedDate()
    {
        return createdDate;
    }
 
    public void setCreatedDate(Date createdDate)
    {
        this.createdDate = createdDate;
    }
 
    public Date getModifiedDate()
    {
        return modifiedDate;
    }
 
    public void setModifiedDate(Date modifiedDate)
    {
        this.modifiedDate = modifiedDate;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p>Note @CreationTimestamp and @UpdateTimestamp annotation to avoid setting date fields explicitly.</p><p>Modify Book and Reader Entity Objects to mane them Auditable</p><p><strong>entity/Book.java</strong></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="initial" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@Audited
@EntityListeners(AuditingEntityListener.class)
public class Book extends BaseEntity
{...}</pre>
</div></div></td></tr></tbody></table></div><p><strong>entity/Reader.java</strong></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="initial" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@Audited
@EntityListeners(AuditingEntityListener.class)
public class Reader extends BaseEntity
{...}</pre>
</div></div></td></tr></tbody></table></div><h3 id="Auditing-ModifyDatatoIncludeDates">Modify Data to Include Dates</h3><p><strong>resources/data.sql</strong></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="initial" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">-- READER
INSERT INTO READER(ID, name, type, created_date, modified_date) VALUES(1, &#39;nick&#39;, &#39;employee&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO READER(ID, name, type, created_date, modified_date) VALUES(2, &#39;paul&#39;, &#39;student&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO READER(ID, name, type, created_date, modified_date) VALUES(3, &#39;sam&#39;, &#39;retired&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO READER(ID, name, type, created_date, modified_date) VALUES(4, &#39;mary&#39;, &#39;employee&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO READER(ID, name, type, created_date, modified_date) VALUES(5, &#39;jim&#39;, &#39;contractor&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
 
--BOOK
INSERT INTO BOOK(ID, title, author, created_date, modified_date) VALUES(1, &#39;Tom Sawyer&#39;, &#39;Mark Twain&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO BOOK(ID, title, author, created_date, modified_date) VALUES(2, &#39;Catch 22&#39;, &#39;Joseph Heller&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
INSERT INTO BOOK(ID, title, author, created_date, modified_date) VALUES(3, &#39;War and Peace&#39;, &#39;Lev Tolstoy&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
 
--READER-BOOK-MAP
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 1)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 3)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(3, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(4, 3)
 
--SEQUENCE
alter sequence HIBERNATE_SEQUENCE restart with 100</pre>
</div></div></td></tr></tbody></table></div><h3 id="Auditing-RunApplicationandCheckData">Run Application and Check Data</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BOOK</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER-BOOK-MAP</strong></p></th></tr><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-25-58.png?version=1&amp;modificationDate=1570739158662&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-25-58.png?version=1&amp;modificationDate=1570739158662&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-25-20.png?version=1&amp;modificationDate=1570739120941&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-25-20.png?version=1&amp;modificationDate=1570739120941&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-27-9.png?version=1&amp;modificationDate=1570739229542&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-27-9.png?version=1&amp;modificationDate=1570739229542&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><h3 id="Auditing-TryInsert/UpdateOperationtoSeeEffectsofAuditing">Try Insert/Update Operation to See Effects of Auditing</h3><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/289866649.png" data-image-src="attachments/289866631/289866649.png" data-height="514" data-width="763" data-unresolved-comment-count="0" data-linked-resource-id="289866649" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121013.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="ae97fc1f-4af6-495f-be47-467d870dd6cb" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/294813697.png" data-image-src="attachments/289866631/294813697.png" data-height="306" data-width="762" data-unresolved-comment-count="0" data-linked-resource-id="294813697" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121041.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="537b5bf2-9220-4da5-9608-1ed973cb6eca" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/290030203.png" data-image-src="attachments/289866631/290030203.png" data-height="554" data-width="764" data-unresolved-comment-count="0" data-linked-resource-id="290030203" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121059.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="34a3bb2f-5d91-4b40-a1ac-a6f8b83f5df8" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/290030209.png" data-image-src="attachments/289866631/290030209.png" data-height="258" data-width="757" data-unresolved-comment-count="0" data-linked-resource-id="290030209" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121115.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="fec50e2d-a918-4e44-b7c6-31dc611f06d4" data-media-type="file"></span><p>Check Audit Logs</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BOOK_AUDIT_LOG</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER_AUDIT_LOG</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>REVINFO</strong></p></th></tr><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-45-8.png?version=1&amp;modificationDate=1570740308747&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-45-8.png?version=1&amp;modificationDate=1570740308747&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-45-49.png?version=1&amp;modificationDate=1570740349735&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-45-49.png?version=1&amp;modificationDate=1570740349735&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-46-44.png?version=1&amp;modificationDate=1570740405076&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-46-44.png?version=1&amp;modificationDate=1570740405076&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><h1 id="Auditing-TryDeleteOperations">Try Delete Operations</h1><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289866631/294813707.png" data-image-src="attachments/289866631/294813707.png" data-height="184" data-width="518" data-unresolved-comment-count="0" data-linked-resource-id="294813707" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121153.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="7275717a-d737-47d7-8c94-47dc142cacde" data-media-type="file"></span><p>Check Audit Logs</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BOOK_AUDIT_LOG</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER_AUDIT_LOG</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>REVINFO</strong></p></th></tr><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-49-38.png?version=1&amp;modificationDate=1570740578345&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-49-38.png?version=1&amp;modificationDate=1570740578345&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-50-18.png?version=1&amp;modificationDate=1570740618112&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/609793932/image2019-10-10_16-50-18.png?version=1&amp;modificationDate=1570740618112&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-50-43.png?version=1&amp;modificationDate=1570740643934&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609793932/image2019-10-10_16-50-43.png?version=1&amp;modificationDate=1570740643934&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p>REVTYPE Values</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 125.0px;"/><col style="width: 633.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Action</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Value</strong></p></th></tr><tr><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>Added</p></td></tr><tr><td class="confluenceTd"><p>1</p></td><td class="confluenceTd"><p>Updated</p></td></tr><tr><td class="confluenceTd"><p>2</p></td><td class="confluenceTd"><p>Deleted</p></td></tr></tbody></table></div><p>Change names of Audit tables</p><p>We can change the suffix of Audit tables by adding a property to application.properties file, for example:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
spring.jpa.properties.org.hibernate.envers.audit_table_suffix=_AUDIT_LOG
...
#logging.level.org.springframework=debug</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h2 id="Auditing-AddAuditingfor@CreatedByand@LastModifiedBy">Add Auditing for @CreatedBy and @LastModifiedBy</h2><p>To get the name of the logged in user, we will need to add security features to our application to extract the Kerberos ID of the logged in user.</p><h3 id="Auditing-AddSecurityDependencytopom.xml">Add Security Dependency to <code>pom.xml</code></h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;dependency&gt;
   &lt;groupId&gt;com.gs.spring&lt;/groupId&gt;
   &lt;artifactId&gt;gs-spring-boot-security&lt;/artifactId&gt;
   &lt;version&gt;2.1.7&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div></div></td></tr></tbody></table></div><p>Make sure to use version.</p><h3 id="Auditing-AddConfigurationClassestoEnableJPAAuditing">Add Configuration Classes to Enable JPA Auditing</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
@EnableJpaAuditing(auditorAwareRef = &quot;auditorAware&quot;)
public class JpaConfig {

    @Bean
    public AuditorAware&lt;String&gt; auditorAware()
    {
        return new AuditorAwareImpl();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p>This class depends on Security-Core Dependency</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class AuditorAwareImpl implements AuditorAware&lt;String&gt;
{
    @Override
    public Optional&lt;String&gt; getCurrentAuditor()
    {
        return Optional.of(SecurityContextHolder.getContext().getAuthentication().getName());
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="Auditing-AddnewfieldsforcreatedByandlastModifiedBytoBaseEntity">Add new fields for <code>createdBy</code> and <code>lastModifiedBy</code> to <code>BaseEntity</code></h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@CreatedBy
@Column(name = &quot;created_by&quot;)
private String createdBy;
@LastModifiedBy
@Column(name = &quot;last_modified_by&quot;)
private String lastModifiedBy;
...
public String getCreatedBy()
{
    return createdBy;
}
public void setCreatedBy(String createdBy)
{
    this.createdBy = createdBy;
}
public String getLastModifiedBy()
{
    return lastModifiedBy;
}
public void setLastModifiedBy(String lastModifiedBy)
{
    this.lastModifiedBy = lastModifiedBy;
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="Auditing-Addnewfieldstothein-memorydatabase">Add new fields to the in-memory database</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">-- READER
INSERT INTO READER(ID, name, type, created_date, modified_date, created_by, last_modified_by) VALUES(1, &#39;nick&#39;, &#39;employee&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO READER(ID, name, type, created_date, modified_date, created_by, last_modified_by) VALUES(2, &#39;paul&#39;, &#39;student&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO READER(ID, name, type, created_date, modified_date, created_by, last_modified_by) VALUES(3, &#39;sam&#39;, &#39;retired&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO READER(ID, name, type, created_date, modified_date, created_by, last_modified_by) VALUES(4, &#39;mary&#39;, &#39;employee&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO READER(ID, name, type, created_date, modified_date, created_by, last_modified_by) VALUES(5, &#39;jim&#39;, &#39;contractor&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)

--BOOK
INSERT INTO BOOK(ID, title, author, created_date, modified_date, created_by, last_modified_by) VALUES(1, &#39;Tom Sawyer&#39;, &#39;Mark Twain&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO BOOK(ID, title, author, created_date, modified_date, created_by, last_modified_by) VALUES(2, &#39;Catch 22&#39;, &#39;Joseph Heller&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO BOOK(ID, title, author, created_date, modified_date, created_by, last_modified_by) VALUES(3, &#39;War and Peace&#39;, &#39;Lev Tolstoy&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, &#39;unknown&#39;, &#39;unknown&#39;)

--READER-BOOK-MAP
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 1)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 3)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(3, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(4, 3)

--SEQUENCE
alter sequence HIBERNATE_SEQUENCE restart with 100</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h2 id="Auditing-TestAuditDatafor@CreatedByand@LastModifiedBy">Test Audit Data for @CreatedBy and @LastModifiedBy</h2><h3 id="Auditing-UseSecureURL">Use Secure URL</h3><p>Once we add security features to our application, we can no longer user URL localhost:8080. The new, secure URL is:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 190.0px;"/><col style="width: 568.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>Secure URL</p></td><td class="confluenceTd"><p><code>localhost.gs.com:8080</code></p></td></tr></tbody></table></div><p>Unfortunately, once the security features are enabled, we can no longer user the H2-Console to view our data.</p><p>The first order of business will be to test the audit information for <code>createBy</code> and <code>lastModifiedBy</code> fields. Note that, originally, we we set values for these fields to &quot;unknown&quot;.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 185.0px;"/><col style="width: 218.0px;"/><col style="width: 555.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Operation</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Request</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p>View existing readers</p></td><td class="confluenceTd"><p><a href="http://localhost.gs.com/" class="external-link" rel="nofollow">localhost.gs.com</a>:8080/readers</p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;unknown&quot;,
  &quot;name&quot;: &quot;nick&quot;,
  &quot;type&quot;: &quot;employee&quot;,
  &quot;key&quot;: 1,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;id&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/1&quot;
    },
    {
      &quot;rel&quot;: &quot;name&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/name/nick&quot;
    },
    {
      &quot;rel&quot;: &quot;type&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/type/employee&quot;
    }
  ]
},
{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;unknown&quot;,
  &quot;name&quot;: &quot;paul&quot;,
  &quot;type&quot;: &quot;student&quot;,
  &quot;key&quot;: 2,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;id&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/2&quot;
    },
    {
      &quot;rel&quot;: &quot;name&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/name/paul&quot;
    },
    {
      &quot;rel&quot;: &quot;type&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/type/student&quot;
    }
  ]
},
{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;unknown&quot;,
  &quot;name&quot;: &quot;sam&quot;,
  &quot;type&quot;: &quot;retired&quot;,
  &quot;key&quot;: 3,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;id&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/3&quot;
    },
    {
      &quot;rel&quot;: &quot;name&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/name/sam&quot;
    },
    {
      &quot;rel&quot;: &quot;type&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/type/retired&quot;
    }
  ]
},
{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;unknown&quot;,
  &quot;name&quot;: &quot;mary&quot;,
  &quot;type&quot;: &quot;employee&quot;,
  &quot;key&quot;: 4,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;id&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/4&quot;
    },
    {
      &quot;rel&quot;: &quot;name&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/name/mary&quot;
    },
    {
      &quot;rel&quot;: &quot;type&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/type/employee&quot;
    }
  ]
},
{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;unknown&quot;,
  &quot;name&quot;: &quot;jim&quot;,
  &quot;type&quot;: &quot;contractor&quot;,
  &quot;key&quot;: 5,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;id&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/5&quot;
    },
    {
      &quot;rel&quot;: &quot;name&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/name/jim&quot;
    },
    {
      &quot;rel&quot;: &quot;type&quot;,
      &quot;href&quot;: &quot;http://localhost.gs.com:8080/readers/type/contractor&quot;
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr></tbody></table></div><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="680" loading="lazy" src="attachments/289866631/289866664.png?width=680" data-image-src="attachments/289866631/289866664.png" data-height="239" data-width="1013" data-unresolved-comment-count="0" data-linked-resource-id="289866664" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121339.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="8904a831-892d-496f-8d14-2f5148123309" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="680" loading="lazy" src="attachments/289866631/289931732.png?width=680" data-image-src="attachments/289866631/289931732.png" data-height="327" data-width="1014" data-unresolved-comment-count="0" data-linked-resource-id="289931732" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121414.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="9ecb44cc-7ad2-4048-81c0-7cd88d92051f" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="680" loading="lazy" src="attachments/289866631/294813715.png?width=680" data-image-src="attachments/289866631/294813715.png" data-height="237" data-width="1014" data-unresolved-comment-count="0" data-linked-resource-id="294813715" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121436.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="b9ac68f8-771d-465b-8cc9-ca3367671893" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" width="680" loading="lazy" src="attachments/289866631/290030219.png?width=680" data-image-src="attachments/289866631/290030219.png" data-height="326" data-width="1008" data-unresolved-comment-count="0" data-linked-resource-id="290030219" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-121453.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289866631" data-linked-resource-container-version="2" data-media-id="070a4e34-342e-4cdb-b07c-91717de3ab9e" data-media-type="file"></span><h1 id="Auditing-Hide@CreatedByand@LastModifiedByfieldsfromdisplay">Hide @CreatedBy and @LastModifiedBy fields from display</h1><p>Once we verified that @CreatedBy and @LastModifiedBy are set to the Kerberos of the logged in user, we can remove them from display by annotating them with @JsonIgnore.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@CreatedBy
@JsonIgnore
@Column(name = &quot;created_by&quot;)
private String createdBy;


@LastModifiedBy
@JsonIgnore
@Column(name = &quot;last_modified_by&quot;)
private String lastModifiedBy;
...</pre>
</div></div></td></tr></tbody></table></div><p />
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/290030189.png">image-20200420-120750.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/289866649.png">image-20200420-121013.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/294813697.png">image-20200420-121041.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/290030203.png">image-20200420-121059.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/290030209.png">image-20200420-121115.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/294813707.png">image-20200420-121153.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/289866664.png">image-20200420-121339.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/289931732.png">image-20200420-121414.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/294813715.png">image-20200420-121436.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289866631/290030219.png">image-20200420-121453.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
