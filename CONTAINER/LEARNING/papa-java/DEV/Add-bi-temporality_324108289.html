<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Add bi-temporality</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Project-Profit-Application_315097089.html">Project Profit Application</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Add bi-temporality
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 30, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="Addbi-temporality-Approachtobi-temporalitywithIN_UTCandOUT_UTCfields.">Approach to bi-temporality with IN_UTC and OUT_UTC fields.</h1><ol><li><p>For record to be valid, the OUT_UTC field must be set to INFINITY_VALUE.</p></li><li><p>Audit records have OUT_UTC value set to the time when the new version of this record was created.</p></li><li><p>Audit record was valid in the time range from IN_UTC to OUT_UTC.</p></li><li><p>The current version of a record and all prior versions of that record have same AUDIT_ID value.</p></li><li><p>A record is never physically deleted. Its OUT_UTC field is set to a date in the past.</p></li><li><p>When a record is initially created, it's OUT_UTC value will be set to infinity. When this record is modified following events will occur:</p><ol><li><p>The original record (one whose OUT_UTC is infinity) will be modified with values which were specified for the modified record.</p></li><li><p>IN_UTC value of the original record will be set to the current time.</p></li><li><p>New record will be created and fields of this new record will be set with values from the original record.</p></li><li><p>New record's IN_UTC value will be set to IN_UTC value of the original record.</p></li><li><p>New record's OUT_UTC value will be set to current time.</p></li></ol></li></ol><p><br/></p><p><br/></p><h1 id="Addbi-temporality-Modifyin-memorydatabasetoaddAUDIT_ID,IN_UTC,andOUT_UTCfields">Modify in-memory database to add AUDIT_ID, IN_UTC, and OUT_UTC fields</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">-- PROJECT
INSERT INTO PROJECT(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_NAME, PROJECT_DESCRIPTION, CREATED_BY, LAST_MODIFIED_BY) VALUES(1, &#39;00000000-0000-0000-0000-000000000001&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;P-1&#39;, &#39;Project one&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_NAME, PROJECT_DESCRIPTION, CREATED_BY, LAST_MODIFIED_BY) VALUES(2, &#39;00000000-0000-0000-0000-000000000002&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;P-2&#39;, &#39;Project two&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_NAME, PROJECT_DESCRIPTION, CREATED_BY, LAST_MODIFIED_BY) VALUES(3, &#39;00000000-0000-0000-0000-000000000003&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;P-3&#39;, &#39;Project three&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_NAME, PROJECT_DESCRIPTION, CREATED_BY, LAST_MODIFIED_BY) VALUES(4, &#39;00000000-0000-0000-0000-000000000004&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;P-4&#39;, &#39;Project four&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

-- EMPLOYEE
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(1, &#39;00000000-0000-0000-0000-000000000001&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-1&#39;, &#39;One First&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(2, &#39;00000000-0000-0000-0000-000000000002&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-2&#39;, &#39;Two Second&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(3, &#39;00000000-0000-0000-0000-000000000003&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-3&#39;, &#39;Three Third&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(4, &#39;00000000-0000-0000-0000-000000000004&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-4&#39;, &#39;Four Forth&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(5, &#39;00000000-0000-0000-0000-000000000005&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-5&#39;, &#39;Five Fifth&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_CODE, EMPLOYEE_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(6, &#39;00000000-0000-0000-0000-000000000006&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;EC-6&#39;, &#39;Six Sixth&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

-- SUBSCRIPTION
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(1, &#39;00000000-0000-0000-0000-000000000001&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-1&#39;, &#39;Subscription 1&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(2, &#39;00000000-0000-0000-0000-000000000002&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-2&#39;, &#39;Subscription 2&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(3, &#39;00000000-0000-0000-0000-000000000003&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-3&#39;, &#39;Subscription 3&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(4, &#39;00000000-0000-0000-0000-000000000004&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-4&#39;, &#39;Subscription 4&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(5, &#39;00000000-0000-0000-0000-000000000005&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-5&#39;, &#39;Subscription 5&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(6, &#39;00000000-0000-0000-0000-000000000006&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-6&#39;, &#39;Subscription 6&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO SUBSCRIPTION(ID, AUDIT_ID, IN_UTC, OUT_UTC, SUBSCRIPTION_CODE, SUBSCRIPTION_NAME, CREATED_BY, LAST_MODIFIED_BY) VALUES(7, &#39;00000000-0000-0000-0000-000000000007&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;SUB-7&#39;, &#39;Subscription 7&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


-- PROJECT-EMPLOYEE-MAP
--  PROJECT 1
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(1, &#39;00000000-0000-0000-0000-000000000001&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 1, 1, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(2, &#39;00000000-0000-0000-0000-000000000002&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 1, 3, &#39;unknown&#39;, &#39;unknown&#39;)
--  PROJECT 2
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(3, &#39;00000000-0000-0000-0000-000000000003&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 2, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(4, &#39;00000000-0000-0000-0000-000000000004&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 4, &#39;unknown&#39;, &#39;unknown&#39;)
-- PROJECT 3
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(5, &#39;00000000-0000-0000-0000-000000000005&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 1, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(6, &#39;00000000-0000-0000-0000-000000000006&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 2, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(7, &#39;00000000-0000-0000-0000-000000000007&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 3, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROJECT_EMPLOYEE_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, PROJECT_ID, EMPLOYEE_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(8, &#39;00000000-0000-0000-0000-000000000008&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 4, &#39;unknown&#39;, &#39;unknown&#39;)

-- EMPLOYEE-SUBSCRIPTION-MAP
--  EMPLOYEE-1
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(1, &#39;00000000-0000-0000-0000-000000000001&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 1, 1, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(2, &#39;00000000-0000-0000-0000-000000000002&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 1, 2, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(3, &#39;00000000-0000-0000-0000-000000000003&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 1, 3, &#39;unknown&#39;, &#39;unknown&#39;)
--  EMPLOYEE-2
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(4, &#39;00000000-0000-0000-0000-000000000004&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 1, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(5, &#39;00000000-0000-0000-0000-000000000005&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 2, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(6, &#39;00000000-0000-0000-0000-000000000006&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 3, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(7, &#39;00000000-0000-0000-0000-000000000007&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 2, 4, &#39;unknown&#39;, &#39;unknown&#39;)
--  EMPLOYEE-3
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(8, &#39;00000000-0000-0000-0000-000000000008&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 1, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(9, &#39;00000000-0000-0000-0000-000000000009&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 3, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(10, &#39;00000000-0000-0000-0000-000000000010&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 3, 5, &#39;unknown&#39;, &#39;unknown&#39;)
--  EMPLOYEE-4
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(11, &#39;00000000-0000-0000-0000-000000000011&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 4, 2, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(12, &#39;00000000-0000-0000-0000-000000000012&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 4, 4, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(13, &#39;00000000-0000-0000-0000-000000000013&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 4, 6, &#39;unknown&#39;, &#39;unknown&#39;)
--  EMPLOYEE-5
INSERT INTO EMPLOYEE_SUBSCRIPTION_MAP(ID, AUDIT_ID, IN_UTC, OUT_UTC, EMPLOYEE_ID, SUBSCRIPTION_ID, CREATED_BY, LAST_MODIFIED_BY) VALUES(14, &#39;00000000-0000-0000-0000-000000000014&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, 5, 1, &#39;unknown&#39;, &#39;unknown&#39;)

--SEQUENCE
alter sequence HIBERNATE_SEQUENCE restart with 101</pre>
</div></div></td></tr></tbody></table></div><h1 id="Addbi-temporality-ChangestoBaseEntityandEntityObjects">Changes to BaseEntity and Entity Objects</h1><p>We will add DATE_INFINITY, inUtc, and outUtc fields to BaseEntity and corresponding getter/setter for inUtc and outUtc.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity extends ResourceSupport
{
    public static ZonedDateTime DATE_INFINITY = ZonedDateTime.parse(&quot;9999-12-31T00:00:00Z&quot;);

    @CreatedBy
    @Column(name = &quot;created_by&quot;)
    private String createdBy;

    @LastModifiedBy
    @Column(name = &quot;last_modified_by&quot;)
    private String lastModifiedBy;

    @CreatedDate
    @Column(name = &quot;created_on&quot;)
    private Date createdOn;

    @Column(name = &quot;in_utc&quot;, nullable = false)
    private Date inUtc;

    @Column(name = &quot;out_utc&quot;)
    private ZonedDateTime outUtc = DATE_INFINITY;

    public String getCreatedBy()
    {
        return createdBy;
    }

    public void setCreatedBy(String createdBy)
    {
        this.createdBy = createdBy;
    }

    public String getLastModifiedBy()
    {
        return lastModifiedBy;
    }

    public void setLastModifiedBy(String lastModifiedBy)
    {
        this.lastModifiedBy = lastModifiedBy;
    }

    public Date getCreatedOn()
    {
        return createdOn;
    }

    public void setCreatedOn(Date createdOn)
    {
        this.createdOn = createdOn;
    }

    public Date getInUtc()
    {
        return inUtc;
    }

    public void setInUtc(Date inUtc)
    {
        this.inUtc = inUtc;
    }

    public ZonedDateTime getOutUtc()
    {
        return outUtc;
    }

    public void setOutUtc(ZonedDateTime outUtc)
    {
        this.outUtc = outUtc;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="Addbi-temporality-Notes:">Notes:</h3><ol><li><p>We do not need createdOn field. It does not seem to serve useful purpose.<br/></p><p><br/></p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@CreatedDate
@Column(name = &quot;created_on&quot;)
private Date createdOn;</pre>
</div></div><p><br/></p></li><li><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">inUtc field should not be marked with @CreatedDate and it should not be nullable but be updateable
@Column(name = &quot;in_utc&quot;, nullable = false)
private Date inUtc;</pre>
</div></div><p><br/></p><p><br/></p></li></ol><h2 id="Addbi-temporality-ModifyeachEntityobjecttoaddauditIdfieldwithgetter/setterandtoaddauniqueconstraint">Modify each Entity object to add <code>auditId</code> field with getter/setter and to add a unique constraint</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@Table(uniqueConstraints={
        @UniqueConstraint(columnNames = {&quot;auditId&quot;, &quot;out_utc&quot;})
})
public class Employee extends BaseEntity
{
   ...
   private String auditId = UUID.randomUUID().toString();


@Entity
@Table(name = &quot;EMPLOYEE_SUBSCRIPTION_MAP&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;auditId&quot;, &quot;out_utc&quot;})
        })
public class EmployeeSubscriptionPair extends BaseEntity
{
   ...
   private String auditId = UUID.randomUUID().toString();

@Entity
@Table(uniqueConstraints={
        @UniqueConstraint(columnNames = {&quot;auditId&quot;, &quot;out_utc&quot;})
})
public class Project extends BaseEntity
{
   ...
   private String auditId = UUID.randomUUID().toString();


@Table(name = &quot;PROJECT_EMPLOYEE_MAP&quot;,
        uniqueConstraints={
        @UniqueConstraint(columnNames = {&quot;auditId&quot;, &quot;out_utc&quot;})
})
public class ProjectEmployeePair extends BaseEntity
{
   ...
   private String auditId = UUID.randomUUID().toString();


@Entity
@Table(uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;auditId&quot;, &quot;out_utc&quot;})
        })
public class Subscription extends BaseEntity
{
   ...
   private String auditId = UUID.randomUUID().toString();

</pre>
</div></div></td></tr></tbody></table></div><h3 id="Addbi-temporality-Note"><code>Note</code></h3><p>The three new fields we added: audit_id, in_utc, and out_utc are automatically set.</p><h1 id="Addbi-temporality-ModifyUpdateandDeletemethodsonallControllers">Modify Update and Delete methods on all Controllers</h1><h2 id="Addbi-temporality-ModifyEntityobjectstoaddnewconstructors">Modify Entity objects to add new constructors</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
//  Constructor for the audit record
public Employee(Employee other)
{
    super();
    this.auditId = other.auditId;
    this.employeeCode = other.employeeCode;
    this.employeeName = other.employeeName;
    this.setOutUtc(ZonedDateTime.now());
    this.setInUtc(other.getInUtc());
 }
public Employee()
{
    super();
}
...</pre>
</div></div></td></tr></tbody></table></div><h2 id="Addbi-temporality-ModifyUpdatemethodofthecontroller">Modify Update method of the controller</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@PutMapping(&quot;/employees/{id}&quot;)
public ResponseEntity&lt;?&gt; updateEmployee(@PathVariable(&quot;id&quot;) int id, @RequestBody Employee employee
{
    Optional&lt;Employee&gt; existingEmployeeOptional = employeeRepository.findById(id);
    if(!existingEmployeeOptional.isPresent())
    {
        throw new NotFoundException(&quot;employee-&quot; + id);
    }
    Employee existingEmployee = existingEmployeeOptional.get();
    Employee autitEmployee = new Employee(existingEmployee);
    existingEmployee.setInUtc(new Date());
    if(StringUtils.hasText(employee.getEmployeeCode()))
    {
        existingEmployee.setEmployeeCode(employee.getEmployeeCode());
    }
    if(StringUtils.hasText(employee.getEmployeeName()))
    {
        existingEmployee.setEmployeeName(employee.getEmployeeName());
    }
    employeeRepository.save(existingEmployee);
    employeeRepository.save(autitEmployee);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .buildAndExpand(existingEmployee).toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="Addbi-temporality-ModifyDELETEmethodoftheentitycontroller">Modify DELETE method of the entity controller</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@DeleteMapping(&quot;/employees/{id}&quot;)
public ResponseEntity&lt;?&gt; deleteEmployee(@PathVariable(&quot;id&quot;) int id)
{
    List&lt;ProjectEmployeePair&gt; projectEmployeePairs = projectEmployeeMapRepository.findByEmployeeId(id);
    if(!projectEmployeePairs.isEmpty())
    {
        throw new ProjectViolationException(&quot;projects exist for employee-&quot; + id);
    }
    List&lt;EmployeeSubscriptionPair&gt; employeeSubscriptionPairs = employeeSubscriptionMapRepository.findByEmployeeId(id);
    if(!employeeSubscriptionPairs.isEmpty())
    {
        throw new SubscriptionViolationException(&quot;subscription exist for employee-&quot; + id);
    }
    Optional&lt;Employee&gt; existingEmployeeOptional = employeeRepository.findById(id);
    if(!existingEmployeeOptional.isPresent())
    {
        throw new NotFoundException(&quot;employee-&quot; + id);
    }
    Employee employee = existingEmployeeOptional.get();
    employee.setOutUtc(ZonedDateTime.now());
    employeeRepository.save(employee);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .buildAndExpand().toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="Addbi-temporality-ModifyDELETEmethodofthemappingcontroller">Modify DELETE method of the mapping controller</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">private ResponseEntity&lt;?&gt; deleteAssociation(int employeeId, int subscriptionId)
{
    Optional&lt;EmployeeSubscriptionPair&gt; employeeSubscriptionPairOptional =
            employeeSubscriptionMapRepository.findByEmployeeIdSubscriptionId(employeeId, subscriptionId);
    if(!employeeSubscriptionPairOptional.isPresent())
    {
        throw new NotFoundException(&quot;employeeId-&quot; + employeeId + &quot;, subscriptionId-&quot; + subscriptionId);
    }
    EmployeeSubscriptionPair employeeSubscriptionPair = employeeSubscriptionPairOptional.get();
    employeeSubscriptionPair.setOutUtc(ZonedDateTime.now());
    employeeSubscriptionMapRepository.save(employeeSubscriptionPair);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .buildAndExpand(employeeSubscriptionPair).toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><p><br/></p><h2 id="Addbi-temporality-Makeseveralchangesafewminutesapartandobserveresults">Make several changes a few minutes apart and observe results</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>PUT Request</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Body</strong></p></th></tr><tr><td class="confluenceTd"><p>localhost:8080/employees/1</p></td><td class="confluenceTd"><p><br/></p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;employeeName&quot;: &quot;one first&quot;
}</pre>
</div></div><p><br/></p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;employeeName&quot;: &quot;ONE FIRST&quot;
}</pre>
</div></div><p><br/></p><p><br/></p></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>GET Request</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/employees/1" class="external-link" rel="nofollow">http://localhost:8080/employees/1</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;createdBy&quot;: &quot;unknown&quot;,
  &quot;lastModifiedBy&quot;: &quot;gunern&quot;,
  &quot;createdOn&quot;: &quot;2020-04-30T14:09:22.845+0000&quot;,
  &quot;inUtc&quot;: &quot;2020-04-30T14:11:52.574+0000&quot;,
  &quot;outUtc&quot;: &quot;9999-12-31T00:00:00Z&quot;,
  &quot;auditId&quot;: &quot;00000000-0000-0000-0000-000000000001&quot;,
  &quot;employeeCode&quot;: &quot;EC-1&quot;,
  &quot;employeeName&quot;: &quot;ONE FIRST&quot;,</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/employees/1" class="external-link" rel="nofollow">http://localhost:8080/employees/1</a>01</p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;createdBy&quot;: &quot;gunern&quot;,
  &quot;lastModifiedBy&quot;: &quot;gunern&quot;,
  &quot;createdOn&quot;: &quot;2020-04-30T14:11:00.273+0000&quot;,
  &quot;inUtc&quot;: &quot;2020-04-30T14:09:22.845+0000&quot;,
  &quot;outUtc&quot;: &quot;2020-04-30T14:11:00.201Z&quot;,
  &quot;auditId&quot;: &quot;00000000-0000-0000-0000-000000000001&quot;,
  &quot;employeeCode&quot;: &quot;EC-1&quot;,
  &quot;employeeName&quot;: &quot;One First&quot;,</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/employees/1" class="external-link" rel="nofollow">http://localhost:8080/employees/1</a>02</p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;createdBy&quot;: &quot;gunern&quot;,
  &quot;lastModifiedBy&quot;: &quot;gunern&quot;,
  &quot;createdOn&quot;: &quot;2020-04-30T14:11:52.576+0000&quot;,
  &quot;inUtc&quot;: &quot;2020-04-30T14:11:00.201+0000&quot;,
  &quot;outUtc&quot;: &quot;2020-04-30T14:11:52.574Z&quot;,
  &quot;auditId&quot;: &quot;00000000-0000-0000-0000-000000000001&quot;,
  &quot;employeeCode&quot;: &quot;EC-1&quot;,
  &quot;employeeName&quot;: &quot;one first&quot;,</pre>
</div></div><p><br/></p></td></tr></tbody></table></div><h3 id="Addbi-temporality-Observations:">Observations:</h3><p>Data changes look correct</p><p>There is no point in having <code>createdOn</code> field since it will always be same as <code>in_utc</code>.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Time</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Record ID</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>in_utc</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>out_utc</strong></p></th></tr><tr><td class="confluenceTd"><p><code>t0</code></p></td><td class="confluenceTd"><p><code>1</code></p></td><td class="confluenceTd"><p><br/></p><p><code>t0t1t2t3</code></p><p><br/></p></td><td class="confluenceTd"><p><br/></p><p><code>∞∞∞∞</code></p><p><br/></p></td></tr><tr><td class="confluenceTd"><p><code>t1</code></p></td><td class="confluenceTd"><p><code>101</code></p></td><td class="confluenceTd"><p><code>t0</code></p></td><td class="confluenceTd"><p><code>t1</code></p></td></tr><tr><td class="confluenceTd"><p><code>t2</code></p></td><td class="confluenceTd"><p><code>102</code></p></td><td class="confluenceTd"><p><code>t1</code></p></td><td class="confluenceTd"><p><code>t2</code></p></td></tr><tr><td class="confluenceTd"><p><code>t3</code></p></td><td class="confluenceTd"><p><code>103</code></p></td><td class="confluenceTd"><p><code>t2</code></p></td><td class="confluenceTd"><p><code>t3</code></p></td></tr></tbody></table></div><p><br/></p><h1 id="Addbi-temporality-ModifyRepositoryclassestouseInfinityDate">Modify Repository classes to use Infinity Date</h1><p>Add DATE_INFINITY String to BaseEntity</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
public static final String DATE_INFINITY_STRING = &quot;&#39;9999-12-31&#39;&quot;;
...</pre>
</div></div></td></tr></tbody></table></div><p>Modify EmployeeRepository class to check for DATE_INFINITY</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface EmployeeRepository extends JpaRepository&lt;Employee, Integer&gt;
{
    @Query(&quot;from Employee where id =:id and outUtc = &quot; + BaseEntity.DATE_INFINITY_STRING)
    Optional&lt;Employee&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;from Employee where outUtc = &quot; + BaseEntity.DATE_INFINITY_STRING)
    List&lt;Employee&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:36</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
