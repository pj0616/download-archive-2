<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Unit Tests</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Project-Profit-Application_315097089.html">Project Profit Application</a></span>
                            </li>
                                                    <li>
                                <span><a href="Unit-and-Integration-Tests-for-Subscription-Tracker_344522760.html">Unit and Integration Tests for Subscription Tracker</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Unit Tests
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on May 11, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="UnitTests-Whatyouputiniswhatyougetout.WewillnotseeanyofthefieldsfromBaseEntitysincewedidnotmockthisinformation">What you put in is what you get out. We will not see any of the fields from BaseEntity since we did not mock this information</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">nameValuePairs = {HashMap@10417}  size = 4
 0 = {HashMap$Node@10420} &quot;subscriptionCode&quot; -&gt; &quot;SUB-1&quot;
 1 = {HashMap$Node@10421} &quot;_links&quot; -&gt; &quot;{&quot;all&quot;:{&quot;...}}
 2 = {HashMap$Node@10422} &quot;subscriptionName&quot; -&gt; &quot;Subscription 1&quot;
 3 = {HashMap$Node@10423} &quot;subscriptionID&quot; -&gt; &quot;1&quot;</pre>
</div></div></td></tr></tbody></table></div><h1 id="UnitTests-UnitTestscouldbeveryusefultoMockdatafromexternalAPIs">Unit Tests could be very useful to Mock data from external APIs</h1><h1 id="UnitTests-NotethattheresponsefromSimpleControllersisaDTOobject">Note that the response from Simple Controllers is a DTO object</h1><h1 id="UnitTests-ModifyEntityobjectstoaddconstructorswhichwillbeutilizedbyunittests:">Modify Entity objects to add constructors which will be utilized by unit tests:</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public Employee(int id, String employeeCode, String employeeName)
{
    this.ID = id;
    this.employeeCode = employeeCode;
    this.employeeName = employeeName;
}


public Project(int id, String projectName, String projectDescription)
{
    this.ID = id;
    this.projectName = projectName;
    this.projectDescription = projectDescription;
}


public Subscription(int id, String subscriptionCode, String subscriptionName)
{
    this.ID = id;
    this.subscriptionCode = subscriptionCode;
    this.subscriptionName = subscriptionName;
}</pre>
</div></div></td></tr></tbody></table></div><h1 id="UnitTests-NewUnitTests">New Unit Tests</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EmployeeControllerTest
{
    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private EmployeeRepository employeeRepository;

    @Test
    public void getEmployeeById() throws Exception
    {
        Employee mockEmployee = new Employee(1, &quot;EC-1&quot;, &quot;One First&quot;);
        Mockito.when(employeeRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(mockEmployee));

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/employees/1&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONObject jsonObject = new JSONObject(resultAsString);

        assertEquals(1, jsonObject.get(&quot;employeeID&quot;));
        assertEquals(&quot;EC-1&quot;, jsonObject.get(&quot;employeeCode&quot;));
        assertEquals(&quot;One First&quot;, jsonObject.get(&quot;employeeName&quot;));
    }

    @Test
    public void getAllEmployees() throws Exception
    {
        List&lt;Employee&gt; mockEmployees = Arrays.asList(
                new Employee(1, &quot;EC-1&quot;, &quot;One First&quot;),
                new Employee(2, &quot;EC-2&quot;, &quot;Two Second&quot;),
                new Employee(3, &quot;EC-3&quot;, &quot;Three Third&quot;),
                new Employee(4, &quot;EC-4&quot;, &quot;Four Forth&quot;)
        );
        Mockito.when(employeeRepository.findAll()).thenReturn(mockEmployees);

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/employees&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONArray jsonArray = new JSONArray(resultAsString);

        assertEquals(4, jsonArray.length());

        JSONObject jsonObject = (JSONObject) jsonArray.get(0);
        assertEquals(1, jsonObject.get(&quot;employeeID&quot;));
        assertEquals(&quot;EC-1&quot;, jsonObject.get(&quot;employeeCode&quot;));
        assertEquals(&quot;One First&quot;, jsonObject.get(&quot;employeeName&quot;));

        jsonObject = (JSONObject) jsonArray.get(1);
        assertEquals(2, jsonObject.get(&quot;employeeID&quot;));
        assertEquals(&quot;EC-2&quot;, jsonObject.get(&quot;employeeCode&quot;));
        assertEquals(&quot;Two Second&quot;, jsonObject.get(&quot;employeeName&quot;));

        jsonObject = (JSONObject) jsonArray.get(2);
        assertEquals(3, jsonObject.get(&quot;employeeID&quot;));
        assertEquals(&quot;EC-3&quot;, jsonObject.get(&quot;employeeCode&quot;));
        assertEquals(&quot;Three Third&quot;, jsonObject.get(&quot;employeeName&quot;));

        jsonObject = (JSONObject) jsonArray.get(3);
        assertEquals(4, jsonObject.get(&quot;employeeID&quot;));
        assertEquals(&quot;EC-4&quot;, jsonObject.get(&quot;employeeCode&quot;));
        assertEquals(&quot;Four Forth&quot;, jsonObject.get(&quot;employeeName&quot;));
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class ProjectControllerTest
{
    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private ProjectRepository projectRepository;

    @Test
    public void getProjectById() throws Exception
    {
        Project mockProject = new Project(1, &quot;P-1&quot;, &quot;Project one&quot;);
        Mockito.when(projectRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(mockProject));

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/projects/1&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONObject jsonObject = new JSONObject(resultAsString);

        assertEquals(1, jsonObject.get(&quot;projectID&quot;));
        assertEquals(&quot;P-1&quot;, jsonObject.get(&quot;projectName&quot;));
        assertEquals(&quot;Project one&quot;, jsonObject.get(&quot;projectDescription&quot;));
    }

    @Test
    public void getAllSubscriptions() throws Exception
    {
        List&lt;Project&gt; mockProjects = Arrays.asList(
                new Project(1, &quot;P-1&quot;, &quot;Project one&quot;),
                new Project(2, &quot;P-2&quot;, &quot;Project two&quot;),
                new Project(3, &quot;P-3&quot;, &quot;Project three&quot;),
                new Project(4, &quot;P-4&quot;, &quot;Project four&quot;)
        );
        Mockito.when(projectRepository.findAll()).thenReturn(mockProjects);

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/projects&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONArray jsonArray = new JSONArray(resultAsString);

        assertEquals(4, jsonArray.length());

        JSONObject jsonObject = (JSONObject) jsonArray.get(0);
        assertEquals(1, jsonObject.get(&quot;projectID&quot;));
        assertEquals(&quot;P-1&quot;, jsonObject.get(&quot;projectName&quot;));
        assertEquals(&quot;Project one&quot;, jsonObject.get(&quot;projectDescription&quot;));

        jsonObject = (JSONObject) jsonArray.get(1);
        assertEquals(2, jsonObject.get(&quot;projectID&quot;));
        assertEquals(&quot;P-2&quot;, jsonObject.get(&quot;projectName&quot;));
        assertEquals(&quot;Project two&quot;, jsonObject.get(&quot;projectDescription&quot;));

        jsonObject = (JSONObject) jsonArray.get(2);
        assertEquals(3, jsonObject.get(&quot;projectID&quot;));
        assertEquals(&quot;P-3&quot;, jsonObject.get(&quot;projectName&quot;));
        assertEquals(&quot;Project three&quot;, jsonObject.get(&quot;projectDescription&quot;));

        jsonObject = (JSONObject) jsonArray.get(3);
        assertEquals(4, jsonObject.get(&quot;projectID&quot;));
        assertEquals(&quot;P-4&quot;, jsonObject.get(&quot;projectName&quot;));
        assertEquals(&quot;Project four&quot;, jsonObject.get(&quot;projectDescription&quot;));
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class SubscriptionControllerTest
{
    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private SubscriptionRepository subscriptionRepository;

    @Test
    public void getSubscriptionById() throws Exception
    {
        Subscription mockSubscription = new Subscription(1, &quot;SUB-1&quot;, &quot;Subscription 1&quot;);
        Mockito.when(subscriptionRepository.findById(Mockito.anyInt())).thenReturn(Optional.of(mockSubscription));

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/subscriptions/1&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONObject jsonObject = new JSONObject(resultAsString);

        assertEquals(1, jsonObject.get(&quot;subscriptionID&quot;));
        assertEquals(&quot;SUB-1&quot;, jsonObject.get(&quot;subscriptionCode&quot;));
        assertEquals(&quot;Subscription 1&quot;, jsonObject.get(&quot;subscriptionName&quot;));
    }

    @Test
    public void getAllSubscriptions() throws Exception
    {
        List&lt;Subscription&gt; mockSubscriptions = Arrays.asList(
                new Subscription(1, &quot;SUB-1&quot;, &quot;Subscription 1&quot;),
                new Subscription(2, &quot;SUB-2&quot;, &quot;Subscription 2&quot;),
                new Subscription(3, &quot;SUB-3&quot;, &quot;Subscription 3&quot;),
                new Subscription(4, &quot;SUB-4&quot;, &quot;Subscription 4&quot;)
        );
        Mockito.when(subscriptionRepository.findAll()).thenReturn(mockSubscriptions);

        RequestBuilder requestBuilder = MockMvcRequestBuilders.get(&quot;/subscriptions&quot;).accept(MediaType.APPLICATION_JSON);
        MvcResult result = mockMvc.perform(requestBuilder).andReturn();

        String resultAsString = result.getResponse().getContentAsString();
        JSONArray jsonArray = new JSONArray(resultAsString);

        assertEquals(4, jsonArray.length());

        JSONObject jsonObject = (JSONObject) jsonArray.get(0);
        assertEquals(1, jsonObject.get(&quot;subscriptionID&quot;));
        assertEquals(&quot;SUB-1&quot;, jsonObject.get(&quot;subscriptionCode&quot;));
        assertEquals(&quot;Subscription 1&quot;, jsonObject.get(&quot;subscriptionName&quot;));

        jsonObject = (JSONObject) jsonArray.get(1);
        assertEquals(2, jsonObject.get(&quot;subscriptionID&quot;));
        assertEquals(&quot;SUB-2&quot;, jsonObject.get(&quot;subscriptionCode&quot;));
        assertEquals(&quot;Subscription 2&quot;, jsonObject.get(&quot;subscriptionName&quot;));

        jsonObject = (JSONObject) jsonArray.get(2);
        assertEquals(3, jsonObject.get(&quot;subscriptionID&quot;));
        assertEquals(&quot;SUB-3&quot;, jsonObject.get(&quot;subscriptionCode&quot;));
        assertEquals(&quot;Subscription 3&quot;, jsonObject.get(&quot;subscriptionName&quot;));

        jsonObject = (JSONObject) jsonArray.get(3);
        assertEquals(4, jsonObject.get(&quot;subscriptionID&quot;));
        assertEquals(&quot;SUB-4&quot;, jsonObject.get(&quot;subscriptionCode&quot;));
        assertEquals(&quot;Subscription 4&quot;, jsonObject.get(&quot;subscriptionName&quot;));
    }
}</pre>
</div></div></td></tr></tbody></table></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:36</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
