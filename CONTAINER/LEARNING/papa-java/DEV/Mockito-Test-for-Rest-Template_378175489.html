<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Mockito Test for Rest Template</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Project-Profit-Application_315097089.html">Project Profit Application</a></span>
                            </li>
                                                    <li>
                                <span><a href="Unit-and-Integration-Tests-for-Subscription-Tracker_344522760.html">Unit and Integration Tests for Subscription Tracker</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Mockito Test for Rest Template
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on May 19, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="MockitoTestforRestTemplate-Description">Description</h1><p>For SoD, we can't create integration tests that make calls to external controllers, such as CAMP, RMS, COM, and PeopleSearch,</p><p>Thus, we need to simulate a response from these external controllers to provide us the data that we would expect to retrieve from real controllers.</p><p>To accomplish this task, we need to mock <code>RestTemplate</code>, which is not as straight forward as mocking other objects, like repository classes.</p><p>Following tests were implemented in <code>sod-overrides</code> POC project.</p><h1 id="MockitoTestforRestTemplate-References">References</h1><p>This problem was solved with aid from following web sites:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Mock Spring RestTemplate using Mockito</p></td><td class="confluenceTd"><p><a href="https://html.developreference.com/article/11428394/How+to+Mock+Spring+RestTemplate+using+mockito%3F" class="external-link" rel="nofollow">https://html.developreference.com/article/11428394/How+to+Mock+Spring+RestTemplate+using+mockito%3F</a></p></td></tr><tr><td class="confluenceTd"><p><a href="https://stackoverflow.com/questions/49128616/mocking-resttemplatebuilder-and-resttemplate-in-spring-integration-test" class="external-link" rel="nofollow">Mocking RestTemplateBuilder and RestTemplate in Spring integration test</a></p></td><td class="confluenceTd"><p><a href="https://stackoverflow.com/questions/49128616/mocking-resttemplatebuilder-and-resttemplate-in-spring-integration-test" class="external-link" rel="nofollow">https://stackoverflow.com/questions/49128616/mocking-resttemplatebuilder-and-resttemplate-in-spring-integration-test</a></p></td></tr></tbody></table></div><h1 id="MockitoTestforRestTemplate-ModifyexternalcontrollerswhichuseRestTemplate">Modify external controllers which use RestTemplate</h1><p>Changes to CampController.java</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
public class CampController
{
    ....
    private RestTemplateBuilder builder;
    private RestTemplate restTemplate;

    @Autowired
    public void setBuilder(RestTemplateBuilder builder)
    {
        this.builder = builder;
    }

    @PostConstruct
    public void init()
    {
        restTemplate = builder.build();
    }
    ...

</pre>
</div></div></td></tr></tbody></table></div><h1 id="MockitoTestforRestTemplate-MockitoTesttomockcallusingRestTemplate">Mockito Test to mock call using RestTemplate</h1><p>test/CampControllerTest</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(MockitoJUnitRunner.class)
public class CampControllerTest
{
    private RestTemplateBuilder mockedBuilder = Mockito.mock(RestTemplateBuilder.class);
    private RestTemplate mockedRestTemplate = Mockito.mock(RestTemplate.class);

    @Before
    public void setUp()
    {
        Mockito.when(mockedBuilder.build()).thenReturn(mockedRestTemplate);

        CampController campController = new CampController();
        campController.setBuilder(mockedBuilder);
        campController.init();
        Mockito.verify(mockedBuilder).build();
    }

    @Test
    public void test1()
    {
        ResponseEntity&lt;String&gt; responseEntity = new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
        Mockito.when(mockedRestTemplate.getForEntity(Mockito.anyString(), Mockito.any(Class.class))).thenReturn(responseEntity);

        ResponseEntity&lt;?&gt; response = mockedRestTemplate.getForEntity(&quot;/camp/guid/800245357/privileges&quot;, List.class);
        assertEquals(HttpStatus.NOT_FOUND, response.getStatusCode());
    }

    @Test
    public void test2()
    {
        List&lt;String&gt; privileges = Arrays.asList(
                &quot;9fb49ead-06fe-36a4-b31b-8e5982603e01&quot;,
                &quot;e6ccff9d-690a-3ab9-97c8-66a0ab0b0552&quot;,
                &quot;ed6e7618-12ca-38f2-aaca-2b6c6cd6af7a&quot;,
                &quot;56d5fd3c-1c0e-3f80-86dc-24dbba67eb18&quot;,
                &quot;eac4de19-59ee-3f08-ab27-2312db133307&quot;,
                &quot;ac4914d8-b601-3195-87c0-ce4b4d431932&quot;,
                &quot;d9874fd9-c1b7-30a5-a74a-316d07e21099&quot;,
                &quot;7426b9a4-68da-3397-96d0-55850693025d&quot;,
                &quot;23640e5c-b209-38ec-acb9-77c4800a41f4&quot;,
                &quot;c9e17da6-7017-3bfc-96d3-cad8e43bbd8f&quot;,
                &quot;efeff618-5a2b-323c-88b7-b5c763769374&quot;,
                &quot;88691955-bc37-34a6-b109-f5fcbd190aa3&quot;,
                &quot;1a8bd0af-5078-357a-98a0-26d8cdc82ebc&quot;,
                &quot;94dce199-2056-3a5f-8bf4-732d6094bfb0&quot;,
                &quot;33082d9a-ab94-317b-a3eb-3ccedf031da2&quot;,
                &quot;ff169148-bf09-315b-9661-fc96d984d56b&quot;,
                &quot;e6dba0dc-6488-3d5b-9c3d-02c69fefe185&quot;,
                &quot;7424f93d-592e-3c2b-9eb5-8805df0ae1e4&quot;,
                &quot;57dcd03c-3933-36ef-beff-6eb2acbf20a9&quot;
        );
        ResponseEntity responseEntity = ResponseEntity.ok(privileges);
        Mockito.when(mockedRestTemplate.getForEntity(Mockito.anyString(), Mockito.any(Class.class))).thenReturn(responseEntity);

        ResponseEntity&lt;?&gt; response = mockedRestTemplate.getForEntity(&quot;/camp/guid/800245357/privileges&quot;, List.class);
        assertEquals(HttpStatus.OK, response.getStatusCode());

        List&lt;String&gt; privilegeIDs = (List&lt;String&gt;)response.getBody();
        assertTrue(privilegeIDs.containsAll(privileges));
    }
}</pre>
</div></div></td></tr></tbody></table></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:36</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
