<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : SoD Eligibility Integration Tests</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Eligibility_289898573.html">Eligibility</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : SoD Eligibility Integration Tests
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 19, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>We are presented with a challenge in implementing Integration tests. We provided support for HTTP and HTTPS, however, when executing Integration tests, we want our application to be enabled for HTTP only. We can accomplish this goal by utilizing <code>application.properties</code> files inheritance. We will start off by changing contents of <code>application.properties</code> file to only contain those properties which will be needed for Integration tests. Note that properties from <code>application.properties</code> files will be inherited by all other, profile specific, <code>application.properties</code> files.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.jpa.show-sql=true
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:db

peoplesearch.url=http://peoplesearch.web.gs.com:6119/GSPeopleSearch/GSPeopleSearch?gsguid=%s&amp;StrictSearch=true&amp;lang=json

spring.data.rest.defaultMediaType=application/json
spring.jackson.default-property-inclusion=NON_NULL

# Enable following 4 lines to generate DDL statements (dialect may not be required)
#spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.DB2Dialect
#spring.jpa.properties.javax.persistence.schema-generation.create-source=metadata
#spring.jpa.properties.javax.persistence.schema-generation.scripts.action=create
#spring.jpa.properties.javax.persistence.schema-generation.scripts.create-target=create.sql

#logging.level.org.springframework=debug</pre>
</div></div></td></tr></tbody></table></div><p>DB2 and H2 profiles will require both HTTP and HTTPS. Thus, we will create another <code>application.properties</code> file which will be included by DB2 and H2 profiles.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">server.http.port=8081
server.port=8443
server.ssl.key-store-type=JKS
server.ssl.key-store=classpath:sod-test.jks
server.ssl.system.account.name=sod_build_test
server.ssl.system.account.credref=9264f331180146bdb758b34369a76f95</pre>
</div></div></td></tr></tbody></table></div><p>Modify <code>application-db2.properties</code> and <code>application-h2.properties</code> files to include <code>application-ssl.properties</code></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.profiles.include=ssl

spring.jpa.properties.hibernate.default_schema=SOD_TEST2
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.DB2Dialect

datasource.url=jdbc:db2://nyg13qi8-vip.ny.fw.gs.com:56834/ntrkdi02
datasource.driver-class-name=com.ibm.db2.jcc.DB2Driver
datasource.system.account.name=dutysepdbuat
datasource.system.account.credref=d0276c30462d4e3c99d7fc2be92a8c69</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.profiles.include=ssl</pre>
</div></div></td></tr></tbody></table></div><h1 id="SoDEligibilityIntegrationTests-IntegrationTests">Integration Tests</h1><p>Refer to <a href="https://confluence.apg.services.gs.com/display/~gunern/Unit+and+Integration+Tests" class="external-link" rel="nofollow">Unit and Integration Tests</a> for details on implementing Integration tests.</p><p>Test for Duty</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class DutyControllerTest
{
    @LocalServerPort
    private int port;

    @Autowired
    private TestRestTemplate testRestTemplate;
    @Test

    public void testA_getDuties()
    {
        ResponseEntity&lt;?&gt; response = testRestTemplate.getForEntity(createUrlWithPort( &quot;/duties&quot;), Resources.class);
        assertThat(response.getStatusCode(), equalTo(HttpStatus.OK));

        ResponseEntity&lt;Resources&lt;LinkedHashMap&lt;String,String&gt;&gt;&gt; dutiesResponse = (ResponseEntity&lt;Resources&lt;LinkedHashMap&lt;String,String&gt;&gt;&gt;)response;

        assertEquals(4, dutiesResponse.getBody().getContent().size());
    }

    private String createUrlWithPort(String uri)
    {
        return &quot;http://localhost:&quot; + port + uri;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="SoDEligibilityIntegrationTests-TestforPeople">Test for People</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class PeopleControllerTest
{
    @LocalServerPort
    private int port;

    @Autowired
    private TestRestTemplate testRestTemplate;

    @Test
    public void
    getPeople()
    {
        ResponseEntity&lt;?&gt; response = testRestTemplate.getForEntity(createUrlWithPort( &quot;/people/800245357&quot;), Map.class);
        assertThat(response.getStatusCode(), equalTo(HttpStatus.OK));

        ResponseEntity&lt;Map&lt;String,String&gt;&gt; peopleResponse = (ResponseEntity&lt;Map&lt;String,String&gt;&gt;)response;
        Map&lt;String,String&gt; valueMap = peopleResponse.getBody();
        assertEquals(&quot;Nicholas.Guner@ny.email.gs.com&quot;, valueMap.get(&quot;mail&quot;));
        assertEquals(&quot;gunern&quot;, valueMap.get(&quot;gskerberosid&quot;));
    }


    private String createUrlWithPort(String uri)
    {
        return &quot;http://localhost:&quot; + port + uri;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
