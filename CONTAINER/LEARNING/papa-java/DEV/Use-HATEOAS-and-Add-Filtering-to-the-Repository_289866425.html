<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Use HATEOAS and Add Filtering to the Repository</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Basic_289898911.html">Basic</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Use HATEOAS and Add Filtering to the Repository
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 20, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>In the <a href="https://confluence.apg.services.gs.com/display/~gunern/JPA+Without+RestController" class="external-link" rel="nofollow">JPA Without RestController</a> tutorial, we employed HATEOAS technology to display links in REST GET response, see <a href="https://confluence.apg.services.gs.com/display/~gunern/JPA+Without+RestController#JPAWithoutRestController-hateoas" class="external-link" rel="nofollow">links in REST GET response</a>.</p><h2 id="UseHATEOASandAddFilteringtotheRepository-WhatisHATEOAS(hat-oye-s)">What is HATEOAS (hat-oye-s)</h2><p><strong>Hypermedia As The Engine Of Application State</strong> (<strong>HATEOAS</strong>) is a component of the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" class="external-link" rel="nofollow">REST application architecture</a> that distinguishes it from other network application architectures.<br/></p><p>Generally speaking, the principle implies that the API should guide the client through the application by returning relevant information about the next potential steps, along with each response.</p><p><a href="https://restfulapi.net/hateoas/" class="external-link" rel="nofollow">HATEOAS</a> is a constraint on REST that says that a client of a REST application need only know a single fixed URL to access it. Any and all resources should be discoverable dynamically from that URL through hyperlinks included in the representations of returned resources.<br/></p><p>Some of he useful information that was used to create this content may be found at following web sites:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URLs</p></td><td class="confluenceTd"><p><br/></p><p><a href="https://stackoverflow.com/questions/22824840/when-to-use-restcontroller-vs-repositoryrestresource" class="external-link" rel="nofollow">https://stackoverflow.com/questions/22824840/when-to-use-restcontroller-vs-repositoryrestresource</a><a href="https://docs.spring.io/spring-data/rest/docs/current/reference/html/#customizing-sdr.overriding-sdr-response-handlers" class="external-link" rel="nofollow">https://docs.spring.io/spring-data/rest/docs/current/reference/html/#customizing-sdr.overriding-sdr-response-handlers</a><a href="https://www.logicbig.com/tutorials/spring-framework/spring-hateoas/resource-and-resources-classes.html" class="external-link" rel="nofollow">https://www.logicbig.com/tutorials/spring-framework/spring-hateoas/resource-and-resources-classes.html</a><a href="https://www.baeldung.com/spring-hateoas-tutorial" class="external-link" rel="nofollow">https://www.baeldung.com/spring-hateoas-tutorial</a></p><p><br/></p></td></tr></tbody></table></div><p><br/></p><h1 id="UseHATEOASandAddFilteringtotheRepository-WhatWeWillDoinThisTutorial">What We Will Do in This Tutorial</h1><p>HATEOAS technology is great since it provides links to allow us easy navigation from one request to another. We achieve this functionality by marking our repository with <code>@RepositoryRestResource</code> annotation:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource(collectionResourceRel = &quot;users&quot;, path=&quot;users&quot;)
public interface UserRepository extends JpaRepository&lt;User, Long&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><p>Unfortunately, when we use this annotation, we lose the ability to provide filtering criteria to our queries. If we wanted to exclude some records from the result, we would need to introduce a controller, marked with another Spring annotation, to filter results.</p><p>In this tutorial, we take the existing exercise and add filtering options to repository. To see this in action, we will modify the existing <code>User</code> class to add <code>lastupdate</code> field.</p><h2 id="UseHATEOASandAddFilteringtotheRepository-ChangestotheUserClass">Changes to the User Class</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class User
{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;
    private String name;
    private String role;
    private String lastupdate;

    public User(String name, String role, String lastupdate)
    {
        this.name = name;
        this.role = role;
        this.lastupdate = lastupdate;
    }

    protected User()
    {
    }

    public long getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getRole() {
        return role;
    }

    public String getLastupdate()
    {
        return lastupdate;
    }

    public void setLastupdate(String lastupdate)
    {
        this.lastupdate = lastupdate;
    }


    @Override
    public String toString()
    {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, role=&#39;&quot; + role + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-Changestothein-memorydatabase">Changes to the in-memory database</h3><p>We also need to modify data.sql file to provide data for the new field:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">INSERT INTO USER(id, name, role, lastupdate) VALUES(1, &#39;nick&#39;, &#39;dev&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(id, name, role, lastupdate) VALUES(2, &#39;paul&#39;, &#39;tech&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(id, name, role, lastupdate) VALUES(3, &#39;sam&#39;, &#39;dev&#39;, &#39;2019-09-01 00:00:00&#39;)
INSERT INTO USER(id, name, role, lastupdate) VALUES(4, &#39;mary&#39;, &#39;support&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(id, name, role, lastupdate) VALUES(5, &#39;jim&#39;, &#39;manager&#39;, &#39;9999-12-01 00:00:00&#39;)</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-Test">Test</h3><p>With everything else intact from the previous step, we can run the application and use the browser to see results:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;users&quot; : [ {
      &quot;name&quot; : &quot;nick&quot;,
      &quot;role&quot; : &quot;dev&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
        },
        &quot;user&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;paul&quot;,
      &quot;role&quot; : &quot;tech&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
        },
        &quot;user&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;sam&quot;,
      &quot;role&quot; : &quot;dev&quot;,
      &quot;lastupdate&quot; : &quot;2019-09-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
        },
        &quot;user&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/3&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;mary&quot;,
      &quot;role&quot; : &quot;support&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
        },
        &quot;user&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;jim&quot;,
      &quot;role&quot; : &quot;manager&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
        },
        &quot;user&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users{?page,size,sort}&quot;,
      &quot;templated&quot; : true
    },
    &quot;profile&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/profile/users&quot;
    }
  },
  &quot;page&quot; : {
    &quot;size&quot; : 20,
    &quot;totalElements&quot; : 5,
    &quot;totalPages&quot; : 1,
    &quot;number&quot; : 0
  }
}</pre>
</div></div><p><br/></p></td></tr></tbody></table></div><p>We can use the HATEOAS  feature of the provided link to fetch individual items, for example:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">http://localhost:8080/users/5</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;name&quot; : &quot;jim&quot;,
  &quot;role&quot; : &quot;manager&quot;,
  &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
    },
    &quot;user&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="UseHATEOASandAddFilteringtotheRepository-AddControllertoFiltertheOutput">Add Controller to Filter the Output</h2><p>When fetching all Users, we want to exclude <code>Users</code> whose <code>lastupdate</code> is not equal to &quot;<code>9999-12-01 00:00:00</code>&quot;</p><p>To accomplish this task, we introduce a <code>Controller</code> class and provide following filtering logic.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RestController
public class UserController
{
    @Autowired
    private UserRepository userRepository;

    @RequestMapping(method= RequestMethod.GET, value=&quot;/users&quot;)
    public List&lt;User&gt; getAllFiltered()
    {
        return StreamSupport.stream(userRepository.findAll().spliterator(), false)
                .filter(u -&gt; u.getLastupdate().equals(&quot;9999-12-01 00:00:00&quot;))
                .collect(Collectors.toList());
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-RepositoryClassRemainsUnchanged">Repository Class Remains Unchanged</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource(collectionResourceRel = &quot;users&quot;, path=&quot;users&quot;)
public interface UserRepository extends JpaRepository&lt;User, Long&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-Test.1">Test</h3><p>Now, when we point the Browser to display all users, note that <code>User</code> with id = 3 is gone since his <code>lastupdate</code> value did not match our criteria.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><p>Response:</p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">[{&quot;id&quot;:1,&quot;name&quot;:&quot;nick&quot;,&quot;role&quot;:&quot;dev&quot;,&quot;lastupdate&quot;:&quot;9999-12-01 00:00:00&quot;},
{&quot;id&quot;:2,&quot;name&quot;:&quot;paul&quot;,&quot;role&quot;:&quot;tech&quot;,&quot;lastupdate&quot;:&quot;9999-12-01 00:00:00&quot;},
{&quot;id&quot;:4,&quot;name&quot;:&quot;mary&quot;,&quot;role&quot;:&quot;support&quot;,&quot;lastupdate&quot;:&quot;9999-12-01 00:00:00&quot;},
{&quot;id&quot;:5,&quot;name&quot;:&quot;jim&quot;,&quot;role&quot;:&quot;manager&quot;,&quot;lastupdate&quot;:&quot;9999-12-01 00:00:00&quot;}]</pre>
</div></div></td></tr></tbody></table></div><p>Note that link information provided by HATEOAS  is also gone.</p><h2 id="UseHATEOASandAddFilteringtotheRepository-ChangeControllertoRestoreHATEOASInformation">Change Controller to Restore HATEOAS Information</h2><p>We will rewrite the <code>UserController</code> class to provide special handling to restore HATEOAS links</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestController
public class UserController
{
    @Autowired
    private UserRepository userRepository;

    @RequestMapping(path = &quot;users&quot;, method = RequestMethod.GET, produces = &quot;application/hal+json&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getAllFiltered()
    {
        List&lt;User&gt; users = StreamSupport.stream(userRepository.findAll().spliterator(), false)
                .filter(u -&gt; u.getLastupdate().equals(&quot;9999-12-01 00:00:00&quot;))
                .collect(Collectors.toList());

        Resources&lt;User&gt; resources = new Resources&lt;&gt;(users);
        resources.add(linkTo(methodOn(UserController.class).getAllFiltered()).withSelfRel());
        return ResponseEntity.ok(resources);

    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-Test.2">Test</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><p>Response:</p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;users&quot; : [ {
      &quot;name&quot; : &quot;nick&quot;,
      &quot;role&quot; : &quot;dev&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;
    }, {
      &quot;name&quot; : &quot;paul&quot;,
      &quot;role&quot; : &quot;tech&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;
    }, {
      &quot;name&quot; : &quot;mary&quot;,
      &quot;role&quot; : &quot;support&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;
    }, {
      &quot;name&quot; : &quot;jim&quot;,
      &quot;role&quot; : &quot;manager&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><p>This result displays data in HATEOAS format but does not include a link for each item.</p><h2 id="UseHATEOASandAddFilteringtotheRepository-AddHATEOASLinktoEachFilteredItem">Add HATEOAS Link to Each Filtered Item</h2><h3 id="UseHATEOASandAddFilteringtotheRepository-MakeChangestoUserEntityClass">Make Changes to User Entity Class</h3><p>We want to make two changes to the <code>User</code> entity class.</p><ol><li><p>We want to inherit from <code>ResourceSupport</code></p></li><li><p>We need to change the <code>id</code> field since the <code>getId</code> method conflicts with <code>ResourceSupport.getId</code>. Thus, we will rename &quot;<code>id</code>&quot; to &quot;<code>ID</code>&quot;</p></li></ol><p>We will also need to change <code>data.sql</code> to change field name from &quot;id&quot; to &quot;ID&quot;</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">INSERT INTO USER(ID, name, role, lastupdate) VALUES(1, &#39;nick&#39;, &#39;dev&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(ID, name, role, lastupdate) VALUES(2, &#39;paul&#39;, &#39;tech&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(ID, name, role, lastupdate) VALUES(3, &#39;sam&#39;, &#39;dev&#39;, &#39;2019-09-01 00:00:00&#39;)
INSERT INTO USER(ID, name, role, lastupdate) VALUES(4, &#39;mary&#39;, &#39;support&#39;, &#39;9999-12-01 00:00:00&#39;)
INSERT INTO USER(ID, name, role, lastupdate) VALUES(5, &#39;jim&#39;, &#39;manager&#39;, &#39;9999-12-01 00:00:00&#39;)</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-MakeChangestotheControllerClass">Make Changes to the Controller Class</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestController
public class UserController
{
    @Autowired
    private UserRepository userRepository;

    @RequestMapping(path = &quot;users&quot;, method = RequestMethod.GET, produces = &quot;application/hal+json&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getAllFiltered()
    {
        List&lt;User&gt; users = StreamSupport.stream(userRepository.findAll().spliterator(), false)
                .filter(u -&gt; u.getLastupdate().equals(&quot;9999-12-01 00:00:00&quot;))
                .map(u -&gt; {u.add(linkTo(UserController.class).slash(&quot;users/&quot; + u.getID()).withSelfRel()); return u;})
                .collect(Collectors.toList());


        Resources&lt;User&gt; resources = new Resources&lt;&gt;(users);
        resources.add(linkTo(methodOn(UserController.class).getAllFiltered()).withSelfRel());
        return ResponseEntity.ok(resources);
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="UseHATEOASandAddFilteringtotheRepository-Test.3">Test</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 120.0px;"/><col style="width: 840.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/users" class="external-link" rel="nofollow">http://localhost:8080/users</a></p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_embedded&quot; : {
    &quot;users&quot; : [ {
      &quot;name&quot; : &quot;nick&quot;,
      &quot;role&quot; : &quot;dev&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/1&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;paul&quot;,
      &quot;role&quot; : &quot;tech&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/2&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;mary&quot;,
      &quot;role&quot; : &quot;support&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/4&quot;
        }
      }
    }, {
      &quot;name&quot; : &quot;jim&quot;,
      &quot;role&quot; : &quot;manager&quot;,
      &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
      &quot;_links&quot; : {
        &quot;self&quot; : {
          &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
        }
      }
    } ]
  },
  &quot;_links&quot; : {
    &quot;self&quot; : [ {
      &quot;href&quot; : &quot;http://localhost:8080/users&quot;
    }, {
      &quot;href&quot; : &quot;http://localhost:8080&quot;
    } ]
  }
}</pre>
</div></div></td></tr></tbody></table></div><p>Now, we can use the link to see information about specific item, for example:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 107.0px;"/><col style="width: 651.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/users/5" class="external-link" rel="nofollow">http://localhost:8080/users/5</a></p></td></tr><tr><td class="confluenceTd"><p>Response</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;name&quot; : &quot;jim&quot;,
  &quot;role&quot; : &quot;manager&quot;,
  &quot;lastupdate&quot; : &quot;9999-12-01 00:00:00&quot;,
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
    },
    &quot;user&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users/5&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><h2 id="UseHATEOASandAddFilteringtotheRepository-Addendum">Addendum</h2><h3 id="UseHATEOASandAddFilteringtotheRepository-CodeSimplification/Enhancement">Code Simplification / Enhancement</h3><p>Since we will need a controller class, marked with @RepositoryRestController Spring annotation, and this controller will specify the path:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RequestMapping(path = &quot;users&quot;, method = RequestMethod.GET, produces = &quot;application/hal+json&quot;)</pre>
</div></div></td></tr></tbody></table></div><p>we no longer need to specify the path in our repository class. Thus, the repository becomes:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface UserRepository extends JpaRepository&lt;User, Long&gt;
{
}</pre>
</div></div></td></tr></tbody></table></div><p>We can also simply annotation used in our controller class:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 79.0px;"/><col style="width: 679.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>From:</strong></p></th><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RequestMapping(path = &quot;users&quot;, method = RequestMethod.GET, produces = &quot;application/hal+json&quot;)</pre>
</div></div></td></tr><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>To:</strong></p></th><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@GetMapping(&quot;/users&quot;)</pre>
</div></div></td></tr></tbody></table></div><p>Another improvement we can make is in the Controller class. Currently, we use a hard-coded for that path, as in:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code>.map(u -&gt; {u.add(linkTo(UserController.class).slash(&quot;users/&quot; + u.getID()).withSelfRel()); return u;})</code></p></td></tr></tbody></table></div><p>This will lead to problems when we try to copy-and-paste this code to other controllers. It would be much better if we could retrieve the path from the @GetMapping annotation:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@GetMapping(&quot;/users&quot;)</pre>
</div></div></td></tr></tbody></table></div><p>This value can be retrieved from <code>HttpServletRequest</code>. The final controller class code is:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@GetMapping(&quot;/users&quot;)
public @ResponseBody ResponseEntity&lt;?&gt; getAllFiltered()
{
    HttpServletRequest httpServletRequest = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();
    List&lt;User&gt; users = StreamSupport.stream(userRepository.findAll().spliterator(), false)
            .filter(u -&gt; u.getLastupdate().equals(&quot;9999-12-01 00:00:00&quot;))
            .map(u -&gt; {u.add(linkTo(UserController.class).slash(httpServletRequest.getRequestURI() + &quot;/&quot; + u.getID()).withSelfRel()); return u;})
            .collect(Collectors.toList());
    Resources&lt;User&gt; resources = new Resources&lt;&gt;(users);
    resources.add(linkTo(methodOn(UserController.class).getAllFiltered()).withSelfRel());
    return ResponseEntity.ok(resources);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="UseHATEOASandAddFilteringtotheRepository-ViewAvailableRESTAPIs">View Available REST APIs</h3><p>We can navigate to host:port URL to display a list of supported REST APIs:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 124.0px;"/><col style="width: 634.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p>localhost:8080</p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_links&quot; : {
    &quot;users&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/users{?page,size,sort}&quot;,
      &quot;templated&quot; : true
    },
    &quot;profile&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/profile&quot;
    }
  }
}</pre>
</div></div></td></tr><tr><td class="confluenceTd"><p>URL:</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/profile" class="external-link" rel="nofollow">http://localhost:8080/profile</a></p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;_links&quot; : {
    &quot;self&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/profile&quot;
    },
    &quot;users&quot; : {
      &quot;href&quot; : &quot;http://localhost:8080/profile/users&quot;
    }
  }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h2 id="UseHATEOASandAddFilteringtotheRepository-TestwithPostman">Test with Postman</h2><p>When we execute a GET request with Postman:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 174.0px;"/><col style="width: 786.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><p>Request:</p></td><td class="confluenceTd"><p>localhost:8080/users</p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/599533180/image2019-9-19_9-45-56.png?version=1&amp;modificationDate=1568900756285&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/599533180/image2019-9-19_9-45-56.png?version=1&amp;modificationDate=1568900756285&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p>For this output, we can click on the HATEOAS link to navigate to the specific item, for example:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Request:</p></td><td class="confluenceTd"><p><a href="http://localhost:8080/users/2" class="external-link" rel="nofollow">http://localhost:8080/users/2</a></p></td></tr><tr><td class="confluenceTd"><p>Response:</p></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/attachments/599533180/image2019-9-19_9-46-43.png?version=1&amp;modificationDate=1568900803083&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/attachments/599533180/image2019-9-19_9-46-43.png?version=1&amp;modificationDate=1568900803083&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
