<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Library Application Redesign</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Basic_289898911.html">Basic</a></span>
                            </li>
                                                    <li>
                                <span><a href="Library-Application-Example_289866546.html">Library Application Example</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Library Application Redesign
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 20, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>The main purpose of this redesign is to fully rely on Hibernate to establish many-to-many relationships. In the original design, we wanted to support a many-to-many relationship between <code>Reader</code> and <code>Book</code> entity objects. Thus, we had created another entity - <code>ReaderBookMap</code>, to map Books to Readers and Readers to Books. The <code>ReaderBookMap</code> was completely independent from <code>Readers</code> and <code>Books</code>. In the current design, we will rely on the <code>@ManyToMany</code> annotation to establish relationship between <code>Reader</code> and <code>Book</code> entity objects and rely on Hibernate to create corresponding tables and to enforce referential constraints.</p><h2 id="LibraryApplicationRedesign-CreateNewSpringBootApplication-&quot;new-library&quot;">Create New SpringBoot Application - &quot;new-library&quot;</h2><p>We will use previously described procedures to create a SpringBoot application and add JPA, H2, and &quot;Rest Repository&quot; dependencies.</p><p>We will enable an in-memory database by adding following properties:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.jpa.show-sql=true
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:db

spring.data.rest.defaultMediaType=application/json
spring.jackson.default-property-inclusion=NON_NULL</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationRedesign-CreateBookandReaderEntityobjectswiththeMany-To-ManyRelationship">Create Book and Reader Entity objects with the Many-To-Many Relationship</h2><p>We will rely on the Hibernate @ManyToMany annotation to establish a many-to-many relationship between Book and Reader entity objects. Since each Book can reference many Readers and each Reader can reference many Books, we will need to add a List to each entity object to support this relationship. Thus:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Book.Java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Reader.java</strong></p></th></tr><tr><td class="confluenceTd"><p><code>...</code></p><p><code>List&lt;Reader&gt; readers = new ArrayList&lt;&gt;();</code></p><p><code>...</code></p></td><td class="confluenceTd"><p><code>...</code></p><p><code>List&lt;Book&gt; books = new ArrayList&lt;&gt;();</code></p><p><code>...</code></p></td></tr></tbody></table></div><p>Both <code>Reader</code> and <code>Book</code> Entity objects will need to add a <code>@ManyToMany</code> annotation to reference the field name on the other side. One of the <code>@ManyToMany</code> annotations will also need to define the structure on the MANY-TO-MANY relationship table. We will choose the Book entity object to define this relationship. We also need to add getters and helper methods to add/remove Book and Reader objects.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class Book extends ResourceSupport
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int bookId;
    private String title;
    private String author;


    @ManyToMany
    @JoinTable(
            name = &quot;READER_BOOK_MAP&quot;,
            joinColumns = {@JoinColumn(name = &quot;BOOK_ID&quot;)},
            inverseJoinColumns = {@JoinColumn(name = &quot;READER_ID&quot;)})
    private List&lt;Reader&gt; readers = new ArrayList&lt;&gt;();

    public int getBookId()
    {
        return bookId;
    }

    public void setBookId(int bookId)
    {
        this.bookId = bookId;
    }

    public String getTitle()
    {
        return title;
    }

    public void setTitle(String title)
    {
        this.title = title;
    }

    public String getAuthor()
    {
        return author;
    }

    public void setAuthor(String author)
    {
        this.author = author;
    }

    public void addReader(Reader r)
    {
        readers.add(r);
        r.getBooks().add(this);
    }

    public void removeReader(Reader r)
    {
        readers.remove(r);
        r.getBooks().remove(this);
    }

    public List&lt;Reader&gt; getReaders()
    {
        return readers;
    }

    @Override
    public String toString()
    {
        return &quot;Book{&quot; +
                &quot;bookId=&quot; + bookId +
                &quot;, title=&#39;&quot; + title + &#39;\&#39;&#39; +
                &quot;, author=&#39;&quot; + author + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
public class Reader extends ResourceSupport
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int readerId;
    private String name;
    private String type;

    @ManyToMany(mappedBy = &quot;readers&quot;)
    private List&lt;Book&gt; books = new ArrayList&lt;&gt;();

    public int getReaderId()
    {
        return readerId;
    }

    public void setReaderId(int id)
    {
        this.readerId = id;
    }

    public String getName()
    {
        return name;
    }

    public void setName(String name)
    {
        this.name = name;
    }

    public String getType()
    {
        return type;
    }

    public void setType(String type)
    {
        this.type = type;
    }

    public List&lt;Book&gt; getBooks()
    {
        return books;
    }

    public void addBook(Book b)
    {
        books.add(b);
        b.getReaders().add(this);
    }

    public void removeBook(Book b)
    {
        books.remove(b);
        b.getReaders().remove(this);
    }

    @Override
    public String toString()
    {
        return &quot;Reader{&quot; +
                &quot;readerId=&quot; + readerId +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, type=&#39;&quot; + type + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationRedesign-AddequalsandhashCodetoEntityClasses">Add equals and hashCode to Entity Classes</h3><p>Since <code>Book</code> will contain a list of <code>Reader</code> objects and <code>Reader</code> will contain a list of <code>Book</code> objects for the many-to-many relationship, we need to implement <code>equals</code> and <code>hashCode</code> methods:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Book.java</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Reader.java</strong></p></th></tr><tr><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Override
public boolean equals(Object o)
{
    if (this == o) return true;
    if (o == null || getClass() != o.getClass()) return false;
    if (!super.equals(o)) return false;
    Book book = (Book) o;
    return bookId == book.bookId &amp;&amp;
            Objects.equals(title, book.title) &amp;&amp;
            Objects.equals(author, book.author);
}
@Override
public int hashCode()
{
    return Objects.hash(super.hashCode(), bookId, title, author);
}</pre>
</div></div></td><td class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Override
public boolean equals(Object o)
{
    if (this == o) return true;
    if (o == null || getClass() != o.getClass()) return false;
    if (!super.equals(o)) return false;
    Reader reader = (Reader) o;
    return readerId == reader.readerId &amp;&amp;
            Objects.equals(name, reader.name) &amp;&amp;
            Objects.equals(type, reader.type);
}
@Override
public int hashCode()
{
    return Objects.hash(super.hashCode(), readerId, name, type);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><p>Lastly, we need to add a file to populate our in-memory database with data. Since we changed <code>GenerationType</code> type to <code>SEQUENCE</code>, we also need to alter the <code>HIBERNATE_SEQUENCE</code>.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">-- READER
INSERT INTO READER(ID, name, type) VALUES(1, &#39;nick&#39;, &#39;employee&#39;)
INSERT INTO READER(ID, name, type) VALUES(2, &#39;paul&#39;, &#39;student&#39;)
INSERT INTO READER(ID, name, type) VALUES(3, &#39;sam&#39;, &#39;retired&#39;)
INSERT INTO READER(ID, name, type) VALUES(4, &#39;mary&#39;, &#39;employee&#39;)
INSERT INTO READER(ID, name, type) VALUES(5, &#39;jim&#39;, &#39;contractor&#39;)

--BOOK
INSERT INTO BOOK(ID, title, author) VALUES(1, &#39;Tom Sawyer&#39;, &#39;Mark Twain&#39;)
INSERT INTO BOOK(ID, title, author) VALUES(2, &#39;Catch 22&#39;, &#39;Joseph Heller&#39;)
INSERT INTO BOOK(ID, title, author) VALUES(3, &#39;War and Peace&#39;, &#39;Lev Tolstoy&#39;)

--READER-BOOK-MAP
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 1)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(1, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(2, 3)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(3, 2)
INSERT INTO READER_BOOK_MAP(READER_ID, BOOK_ID) VALUES(4, 3)


--SEQUENCE
alter sequence HIBERNATE_SEQUENCE restart with 100</pre>
</div></div></td></tr></tbody></table></div><p>Now, we can fire up our application and observe data in tables:</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>BOOK</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>READER-BOOK-MAP</strong></p></th></tr><tr><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-30-8.png?version=1&amp;modificationDate=1570627808457&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-30-8.png?version=1&amp;modificationDate=1570627808457&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-29-33.png?version=1&amp;modificationDate=1570627773985&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-29-33.png?version=1&amp;modificationDate=1570627773985&amp;api=v2" loading="lazy"></span></td><td class="confluenceTd"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image confluence-external-resource image-center" src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-30-36.png?version=1&amp;modificationDate=1570627836405&amp;api=v2" data-image-src="https://confluence.apg.services.gs.com/download/thumbnails/609791178/image2019-10-9_9-30-36.png?version=1&amp;modificationDate=1570627836405&amp;api=v2" loading="lazy"></span></td></tr></tbody></table></div><h2 id="LibraryApplicationRedesign-AddRESTAPIstoReadDatafromEntityObject">Add REST APIs to Read Data from Entity Object</h2><p>In this section we will create Repository classes for Book and Reader objects and a Controller class to expose REST endpoints.</p><p>Before we show you the code we need to emphasize a few points about the kind of data we would like to display</p><ol><li><p>We want to be able to view add Books and all Readers</p></li><li><p>More importantly, we are interested in viewing Readers that have Books and Books that have Readers</p></li><li><p>We want to view a single Book or a single Reader by a unique ID.</p></li><li><p>Books and Readers have attributes, we what to be able to query by these attributes.</p></li><li><p>When querying Books or Readers by attributes, we expect to return a list rather than a single item. For example, multiple books may be written by the same author.</p></li><li><p>Note that the ID field is not displayed along with object attributes. More on that later.</p></li><li><p>Some of the code is repetitive and should be factored out. We won't worry about it in this exercise.</p></li></ol><h3 id="LibraryApplicationRedesign-RepositoryClasses">Repository Classes</h3><p>We want to be able to query our Entity object by various attributes</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface BookRepository  extends JpaRepository&lt;Book, Integer&gt;
{
    @Query(&quot;select b from Book b where b.id = :id&quot;)
    Optional&lt;Book&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select b from Book b where b.author = :author&quot;)
    List&lt;Book&gt; findByAuthor(@Param(&quot;author&quot;) String bookAuthor);

    @Query(&quot;select b from Book b where b.title = :title&quot;)
    List&lt;Book&gt; findByTitle(@Param(&quot;title&quot;) String title);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RepositoryRestResource
public interface ReaderRepository  extends JpaRepository&lt;Reader, Integer&gt;
{
    @Query(&quot;select r from Reader r where r.id = :id&quot;)
    Optional&lt;Reader&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select r from Reader r where r.name = :name&quot;)
    List&lt;Reader&gt; findByName(@Param(&quot;name&quot;) String name);

    @Query(&quot;select r from Reader r where r.type = :type&quot;)
    List&lt;Reader&gt; findByType(@Param(&quot;type&quot;) String type);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationRedesign-ControllerClass">Controller Class</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@RestController
@RepositoryRestController
public class LibraryController
{
    @Autowired
    private BookRepository bookRepository;
    @Autowired
    private ReaderRepository readerRepository;

    @GetMapping(&quot;/books&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getBooks()
    {
        List&lt;Book&gt; books = bookRepository.findAll();

        List&lt;Book&gt; linkedBooks = books.stream()
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooks()).slash( &quot;/&quot; + b.getBookId()).withRel(&quot;id&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByTitle(b.getTitle())).withRel(&quot;title&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByAuthor(b.getAuthor())).withRel(&quot;author&quot;)); return b;})
                .collect(Collectors.toList());

        Resources&lt;Book&gt; resources = new Resources&lt;&gt;(linkedBooks);
        resources.add(linkTo(methodOn(getClass()).getBooks()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    //  --------------------------------
    //  --------- GET Books ------------
    //  --------------------------------
    @GetMapping(&quot;/books/{id}&quot;)
    public  ResponseEntity&lt;Resource&lt;Book&gt;&gt;  getBook(@PathVariable(&quot;id&quot;) int id)
    {
        Optional&lt;Book&gt; bookOptional = bookRepository.findById(id);

        if(!bookOptional.isPresent())
        {
            throw new NotFoundException(&quot;id-&quot; + id);
        }
        Book book = bookOptional.get();
        Resource&lt;Book&gt; resource = new Resource&lt;&gt;(book);
        ControllerLinkBuilder linkTo = linkTo(methodOn(getClass()).getBooks());
        resource.add(linkTo.withRel(&quot;all-books&quot;));
        return ResponseEntity.ok(resource);
    }

    @GetMapping(&quot;/books/title/{title}&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getBooksByTitle(@PathVariable(&quot;title&quot;) String title)
    {
        List&lt;Book&gt; books = bookRepository.findByTitle(title);

        if(books.isEmpty())
        {
            throw new NotFoundException(&quot;title-&quot; + title);
        }
        List&lt;Book&gt; linkedBooks = books.stream()
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooks()).slash( &quot;/&quot; + b.getBookId()).withRel(&quot;id&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByTitle(b.getTitle())).withRel(&quot;title&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByAuthor(b.getAuthor())).withRel(&quot;author&quot;)); return b;})
                .collect(Collectors.toList());

        Resources&lt;Book&gt; resources = new Resources&lt;&gt;(linkedBooks);
        resources.add(linkTo(methodOn(getClass()).getBooks()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/books/author/{author}&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getBooksByAuthor(@PathVariable(&quot;author&quot;) String author)
    {
        List&lt;Book&gt; books = bookRepository.findByAuthor(author);

        if(books.isEmpty())
        {
            throw new NotFoundException(&quot;author-&quot; + author);
        }
        List&lt;Book&gt; linkedBooks = books.stream()
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooks()).slash( &quot;/&quot; + b.getBookId()).withRel(&quot;id&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByTitle(b.getTitle())).withRel(&quot;title&quot;)); return b;})
                .map(b -&gt; {b.add(linkTo(methodOn(getClass()).getBooksByAuthor(b.getAuthor())).withRel(&quot;author&quot;)); return b;})
                .collect(Collectors.toList());

        Resources&lt;Book&gt; resources = new Resources&lt;&gt;(linkedBooks);
        resources.add(linkTo(methodOn(getClass()).getBooks()).withSelfRel());
        return ResponseEntity.ok(resources);
    }


    //  --------------------------------
    //  --------- GET Readers ----------
    //  --------------------------------
    @GetMapping(&quot;/readers&quot;)
    public @ResponseBody
    ResponseEntity&lt;?&gt; getReaders()
    {
        List&lt;Reader&gt; readers = readerRepository.findAll();

        List&lt;Reader&gt; linkedReaders = readers.stream()
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReaders()).slash( &quot;/&quot; + r.getReaderId()).withRel(&quot;id&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByName(r.getName())).withRel(&quot;name&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByType(r.getType())).withRel(&quot;type&quot;)); return r;})
                .collect(Collectors.toList());

        Resources&lt;Reader&gt; resources = new Resources&lt;&gt;(linkedReaders);
        resources.add(linkTo(methodOn(getClass()).getReaders()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/readers/{id}&quot;)
    public  ResponseEntity&lt;Resource&lt;Reader&gt;&gt;  getReader(@PathVariable(&quot;id&quot;) int id)
    {
        Optional&lt;Reader&gt; readerOptional = readerRepository.findById(id);

        if(!readerOptional.isPresent())
        {
            throw new NotFoundException(&quot;id-&quot; + id);
        }
        Reader reader = readerOptional.get();
        Resource&lt;Reader&gt; resource = new Resource&lt;&gt;(reader);
        ControllerLinkBuilder linkTo = linkTo(methodOn(getClass()).getReaders());
        resource.add(linkTo.withRel(&quot;all-readers&quot;));
        return ResponseEntity.ok(resource);
    }


    @GetMapping(&quot;/readers/name/{name}&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getReadersByName(@PathVariable(&quot;name&quot;) String name)
    {
        List&lt;Reader&gt; readers = readerRepository.findByName(name);

        if(readers.isEmpty())
        {
            throw new NotFoundException(&quot;reader-&quot; + name);
        }

        List&lt;Reader&gt; linkedReaders = readers.stream()
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReaders()).slash( &quot;/&quot; + r.getReaderId()).withRel(&quot;id&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByName(r.getName())).withRel(&quot;name&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByType(r.getType())).withRel(&quot;type&quot;)); return r;})
                .collect(Collectors.toList());

        Resources&lt;Reader&gt; resources = new Resources&lt;&gt;(linkedReaders);
        resources.add(linkTo(methodOn(getClass()).getReaders()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/readers/type/{type}&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getReadersByType(@PathVariable(&quot;type&quot;) String type)
    {
        List&lt;Reader&gt; readers = readerRepository.findByType(type);

        if(readers.isEmpty())
        {
            throw new NotFoundException(&quot;reader-&quot; + type);
        }

        List&lt;Reader&gt; linkedReaders = readers.stream()
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReaders()).slash( &quot;/&quot; + r.getReaderId()).withRel(&quot;id&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByName(r.getName())).withRel(&quot;name&quot;)); return r;})
                .map(r -&gt; {r.add(linkTo(methodOn(getClass()).getReadersByType(r.getType())).withRel(&quot;type&quot;)); return r;})
                .collect(Collectors.toList());

        Resources&lt;Reader&gt; resources = new Resources&lt;&gt;(linkedReaders);
        resources.add(linkTo(methodOn(getClass()).getReaders()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    //  -------------------------------------------
    //  --------- GET Books With Readers ----------
    //  -------------------------------------------
    @GetMapping(&quot;/books/readers&quot;)
    public @ResponseBody ResponseEntity&lt;?&gt; getBooksReaders()
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        List&lt;Book&gt; books = bookRepository.findAll();
        for(Book book : books)
        {
            if(!book.getReaders().isEmpty())
            {
                Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(book.getBookId()));

                bookResource.add(createReadersForBookLink(book.getBookId()));
                for(Reader reader : book.getReaders())
                {
                     bookResource.add(createReaderLink(reader.getReaderId()));
                }
                resourceResult.add(bookResource);
            }
        }
        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getBooksReaders()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/books/{id}/readers&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getBooksForReader(@PathVariable(&quot;id&quot;) int id)
    {
        Optional&lt;Book&gt; bookOptional = bookRepository.findById(id);

        if(!bookOptional.isPresent())
        {
            throw new NotFoundException(&quot;id-&quot; + id);
        }

        Book book = bookOptional.get();
        if(book.getReaders().isEmpty())
        {
            throw new NotFoundException(&quot;Readers for id-&quot; + id);
        }

        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
        Resource&lt;Book&gt; bookResource = new Resource&lt;&gt;(book, createBookLink(book.getBookId()));

        for(Reader reader : book.getReaders())
        {
            bookResource.add(createReaderLink(reader.getReaderId()));
        }
        resourceResult.add(bookResource);
        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getBooksForReader(id)).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    //  -------------------------------------------
    //  --------- GET Readers With Books ----------
    //  -------------------------------------------
    @GetMapping(&quot;/readers/books&quot;)
    public @ResponseBody ResponseEntity&lt;?&gt; getReadersBooks()
    {
        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        List&lt;Reader&gt; readers = readerRepository.findAll();
        for(Reader reader : readers)
        {
            if(!reader.getBooks().isEmpty())
            {
                Resource&lt;Reader&gt; readerResource = new Resource&lt;&gt;(reader, createReaderLink(reader.getReaderId()));

                readerResource.add(createBooksForReaderLink(reader.getReaderId()));
                for(Book book : reader.getBooks())
                {
                    readerResource.add(createBookLink(book.getBookId()));
                }
                resourceResult.add(readerResource);
            }
        }
        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getReadersBooks()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/readers/{id}/books&quot;)
    public  @ResponseBody ResponseEntity&lt;?&gt;  getReadersForBook(@PathVariable(&quot;id&quot;) int id)
    {
        Optional&lt;Reader&gt; readerOptional = readerRepository.findById(id);

        if(!readerOptional.isPresent())
        {
            throw new NotFoundException(&quot;id-&quot; + id);
        }

        Reader reader = readerOptional.get();
        if(reader.getBooks().isEmpty())
        {
            throw new NotFoundException(&quot;Books for id-&quot; + id);
        }

        List&lt;Resource&lt;?&gt;&gt; resourceResult = new ArrayList&lt;&gt;();
        Resource&lt;Reader&gt; readerResource = new Resource&lt;&gt;(reader, createReaderLink(reader.getReaderId()));

        for(Book book : reader.getBooks())
        {
            readerResource.add(createBookLink(book.getBookId()));
        }
        resourceResult.add(readerResource);
        Resources&lt;Resource&lt;?&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getReadersForBook(id)).withSelfRel());
        return ResponseEntity.ok(resources);
    }
    //  -------------------------------------------
    //   ----------- Helper Methods  --------------
    //  -------------------------------------------
    private Link createReaderLink(int readerId)
    {
        return linkTo(methodOn(getClass()).getReader(readerId)).withRel(&quot;reader&quot;);
    }

    private Link createReadersForBookLink(int bookId)
    {
        return linkTo(methodOn(getClass()).getBooksForReader(bookId)).withRel(&quot;readers&quot;);
    }


    private Link createBookLink(int bookId)
    {
        return linkTo(methodOn(getClass()).getBook(bookId)).withRel(&quot;book&quot;);
    }

    private Link createBooksForReaderLink(int readerId)
    {
        return linkTo(methodOn(getClass()).getReadersForBook(readerId)).withRel(&quot;books&quot;);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationRedesign-Tests">Tests</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 219.0px;"/><col style="width: 739.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Request</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books" class="external-link" rel="nofollow">http://localhost:8080/books</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/books&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;title&quot;: &quot;Tom Sawyer&quot;,
      &quot;author&quot;: &quot;Mark Twain&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;
        },
        {
          &quot;rel&quot;: &quot;title&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/title/Tom%20Sawyer&quot;
        },
        {
          &quot;rel&quot;: &quot;author&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/author/Mark%20Twain&quot;
        }
      ]
    },
    {
      &quot;title&quot;: &quot;Catch 22&quot;,
      &quot;author&quot;: &quot;Joseph Heller&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        },
        {
          &quot;rel&quot;: &quot;title&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/title/Catch%2022&quot;
        },
        {
          &quot;rel&quot;: &quot;author&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/author/Joseph%20Heller&quot;
        }
      ]
    },
    {
      &quot;title&quot;: &quot;War and Peace&quot;,
      &quot;author&quot;: &quot;Lev Tolstoy&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;
        },
        {
          &quot;rel&quot;: &quot;title&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/title/War%20and%20Peace&quot;
        },
        {
          &quot;rel&quot;: &quot;author&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/author/Lev%20Tolstoy&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/1" class="external-link" rel="nofollow">http://localhost:8080/books/1</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;title&quot;: &quot;Tom Sawyer&quot;,
  &quot;author&quot;: &quot;Mark Twain&quot;,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;all-books&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/books&quot;
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><br/></p><p><a href="http://localhost:8080/books/title/Tom%20Sawyer" class="external-link" rel="nofollow">http://localhost:8080/books/title/Tom%20Sawyer</a><a href="http://localhost:8080/books/author/Mark%20Twain" class="external-link" rel="nofollow">http://localhost:8080/books/author/Mark%20Twain</a></p><p><br/></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/books&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;title&quot;: &quot;Tom Sawyer&quot;,
      &quot;author&quot;: &quot;Mark Twain&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;
        },
        {
          &quot;rel&quot;: &quot;title&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/title/Tom%20Sawyer&quot;
        },
        {
          &quot;rel&quot;: &quot;author&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/author/Mark%20Twain&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers" class="external-link" rel="nofollow">http://localhost:8080/readers</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;name&quot;: &quot;nick&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/nick&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/employee&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;paul&quot;,
      &quot;type&quot;: &quot;student&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/paul&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/student&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;sam&quot;,
      &quot;type&quot;: &quot;retired&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/3&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/sam&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/retired&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;mary&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/4&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/mary&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/employee&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;jim&quot;,
      &quot;type&quot;: &quot;contractor&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/5&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/jim&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/contractor&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/1" class="external-link" rel="nofollow">http://localhost:8080/readers/1</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;name&quot;: &quot;nick&quot;,
  &quot;type&quot;: &quot;employee&quot;,
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;all-readers&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers&quot;
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/1" class="external-link" rel="nofollow">http://localhost:8080/readers/1</a></p><p><br/></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;name&quot;: &quot;nick&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/nick&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/employee&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/type/employee" class="external-link" rel="nofollow">http://localhost:8080/readers/type/employee</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;name&quot;: &quot;nick&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/nick&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/employee&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;mary&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;id&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/4&quot;
        },
        {
          &quot;rel&quot;: &quot;name&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/name/mary&quot;
        },
        {
          &quot;rel&quot;: &quot;type&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/type/employee&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/author/Mark%20Twain" class="external-link" rel="nofollow">http://localhost:8080/books/author/Mark%20Twain</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/books/readers&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;title&quot;: &quot;Tom Sawyer&quot;,
      &quot;author&quot;: &quot;Mark Twain&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;
        },
        {
          &quot;rel&quot;: &quot;readers&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/1/readers&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        }
      ]
    },
    {
      &quot;title&quot;: &quot;Catch 22&quot;,
      &quot;author&quot;: &quot;Joseph Heller&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        },
        {
          &quot;rel&quot;: &quot;readers&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2/readers&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/3&quot;
        }
      ]
    },
    {
      &quot;title&quot;: &quot;War and Peace&quot;,
      &quot;author&quot;: &quot;Lev Tolstoy&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;
        },
        {
          &quot;rel&quot;: &quot;readers&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3/readers&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/4&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/2/readers" class="external-link" rel="nofollow">http://localhost:8080/books/2/readers</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/books/readers&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;title&quot;: &quot;Catch 22&quot;,
      &quot;author&quot;: &quot;Joseph Heller&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/3&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/books" class="external-link" rel="nofollow">http://localhost:8080/readers/books</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers/books&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;name&quot;: &quot;nick&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1&quot;
        },
        {
          &quot;rel&quot;: &quot;books&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/1/books&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;paul&quot;,
      &quot;type&quot;: &quot;student&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;books&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2/books&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;sam&quot;,
      &quot;type&quot;: &quot;retired&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/3&quot;
        },
        {
          &quot;rel&quot;: &quot;books&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/3/books&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;mary&quot;,
      &quot;type&quot;: &quot;employee&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/4&quot;
        },
        {
          &quot;rel&quot;: &quot;books&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/4/books&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/2/books" class="external-link" rel="nofollow">http://localhost:8080/readers/2/books</a></p></td><td class="confluenceTd"><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
  &quot;links&quot;: [
    {
      &quot;rel&quot;: &quot;self&quot;,
      &quot;href&quot;: &quot;http://localhost:8080/readers/2/books&quot;
    }
  ],
  &quot;content&quot;: [
    {
      &quot;name&quot;: &quot;paul&quot;,
      &quot;type&quot;: &quot;student&quot;,
      &quot;links&quot;: [
        {
          &quot;rel&quot;: &quot;reader&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/readers/2&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/2&quot;
        },
        {
          &quot;rel&quot;: &quot;book&quot;,
          &quot;href&quot;: &quot;http://localhost:8080/books/3&quot;
        }
      ]
    }
  ]
}</pre>
</div></div><p><br/></p></td></tr></tbody></table></div><h3 id="LibraryApplicationRedesign-AddIDofEntityObjectstoJSONResponse">Add ID of Entity Objects to JSON Response</h3><p>If you examine responses from above, you would note that the ID of the object is not displayed with implementation of HATEOAS links. We can display the ID (with name &quot;key&quot;) by adding a @Transient field to Entity objects.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@Transient
private int key;
public int getKey()
{
    return readerId;
}
public void setKey(int key)
{
    this.key = readerId;
}
...</pre>
</div></div></td></tr></tbody></table></div><p>After this change, we can view ID of the displayed object:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code>{</code><br/><code> &quot;title&quot;: &quot;Tom Sawyer&quot;,</code><br/><code> &quot;author&quot;: &quot;Mark Twain&quot;,</code><br/><code> &quot;key&quot;: 1,</code><br/><code> &quot;links&quot;: [</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;id&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;title&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/title/Tom%20Sawyer&quot;</code><br/><code> },</code><br/><code> {</code><br/><code> &quot;rel&quot;: &quot;author&quot;,</code><br/><code> &quot;href&quot;: &quot;http://localhost:8080/books/author/Mark%20Twain&quot;</code><br/><code> }</code><br/><code> ]</code><br/><code>},</code></p></td></tr></tbody></table></div><h2 id="LibraryApplicationRedesign-AddRESTAPIstoPOST/PUT/DELETEEntityObjects">Add REST APIs to POST/PUT/DELETE Entity Objects</h2><h3 id="LibraryApplicationRedesign-BookOperations">Book Operations</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/books&quot;)
public ResponseEntity&lt;?&gt; createBook(Book book)
{
    Book savedBook = bookRepository.save(book);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(savedBook.getBookId()).toUri();
    return ResponseEntity.created(location).build();
}
@DeleteMapping(&quot;/books/{id}&quot;)
public void deleteBook(@PathVariable(&quot;id&quot;) int id)
{
    Optional&lt;Book&gt; bookOptional = bookRepository.findById(id);
    if(!bookOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    bookRepository.deleteById(id);
}
@PutMapping(&quot;/books&quot;)
public ResponseEntity&lt;?&gt; updateBook(@RequestBody Book book)
{
    Optional&lt;Book&gt; existingBookOptional = bookRepository.findById(book.getBookId());
    if(!existingBookOptional.isPresent())
    {
        throw new NotFoundException(&quot;book-&quot; + book.getBookId());
    }
    Book existingBook = existingBookOptional.get();
    if(StringUtils.hasText(book.getTitle()))
    {
        existingBook.setTitle(book.getTitle());
    }
    if(StringUtils.hasText(book.getAuthor()))
    {
        existingBook.setAuthor(book.getAuthor());
    }
    bookRepository.save(existingBook);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(existingBook.getBookId()).toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationRedesign-ReaderOperations">Reader Operations</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/readers&quot;)
public ResponseEntity&lt;?&gt; createReader(Reader reader)
{
    Reader savedReader = readerRepository.save(reader);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(savedReader.getReaderId()).toUri();
    return ResponseEntity.created(location).build();
}
@DeleteMapping(&quot;/readers/{id}&quot;)
public void deleteReader(@PathVariable(&quot;id&quot;) int id)
{
    Optional&lt;Reader&gt; readerOptional = readerRepository.findById(id);
    if(!readerOptional.isPresent())
    {
        throw new NotFoundException(&quot;id-&quot; + id);
    }
    readerRepository.deleteById(id);
}
@PutMapping(&quot;/readers&quot;)
public ResponseEntity&lt;?&gt; updateReader(@RequestBody Reader reader)
{
    Optional&lt;Reader&gt; existingReaderOptional = readerRepository.findByI
    if(!existingReaderOptional.isPresent())
    {
        throw new NotFoundException(&quot;reader-&quot; + reader.getReaderId());
    }
    Reader existingReader = existingReaderOptional.get();
    if(StringUtils.hasText(reader.getName()))
    {
        existingReader.setName(reader.getName());
    }
    if(StringUtils.hasText(reader.getType()))
    {
        existingReader.setType(reader.getType());
    }
    readerRepository.save(existingReader);
    URI location = ServletUriComponentsBuilder
            .fromCurrentRequest()
            .path(&quot;/{id}&quot;)
            .buildAndExpand(existingReader.getReaderId()).toUri();
    return ResponseEntity.created(location).build();
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="LibraryApplicationRedesign-Reader/BookOperations">Reader/Book Operations</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/books/{bookId}/readers/{readerId}&quot;)
public ResponseEntity&lt;?&gt; addReaderToBook(@PathVariable(&quot;bookId&quot;) int bookId, @PathVariable(&quot;readerId&quot;
{
    Optional&lt;Reader&gt; readerOptional = readerRepository.findById(readerId);
    if(!readerOptional.isPresent())
    {
        throw new NotFoundException(&quot;reader-&quot; + readerId);
    }
    Optional&lt;Book&gt; bookOptional = bookRepository.findById(bookId);
    if(!bookOptional.isPresent())
    {
        throw new NotFoundException(&quot;book-&quot; + bookId);
    }
    Book book = bookOptional.get();
    Reader reader = readerOptional.get();
    if(!book.getReaders().contains(reader))
    {
        book.addReader(reader);
        bookRepository.save(book);
        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand(book.getBookId(), reader.getReaderId())
                .toUri();
        return ResponseEntity.created(location).build();
    }
    return null;
}
@DeleteMapping(&quot;/books/{bookId}/readers/{readerId}&quot;)
public void deleteReaderFromBook(@PathVariable(&quot;bookId&quot;) int bookId, @PathVariable(&quot;readerId&quot;) int re
{
    Optional&lt;Reader&gt; readerOptional = readerRepository.findById(readerId);
    if(!readerOptional.isPresent())
    {
        throw new NotFoundException(&quot;reader-&quot; + readerId);
    }
    Optional&lt;Book&gt; bookOptional = bookRepository.findById(bookId);
    if(!bookOptional.isPresent())
    {
        throw new NotFoundException(&quot;book-&quot; + bookId);
    }
    Book book = bookOptional.get();
    Reader reader = readerOptional.get();
    if(!book.getReaders().contains(reader))
    {
        throw new NotFoundException(&quot;reader-&quot; + readerId + &quot; in book-&quot; + bookId);
    }
    book.removeReader(reader);
    bookRepository.save(book);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationRedesign-Book/ReaderOperations">Book/Reader Operations</h3><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@PostMapping(&quot;/readers/{readerId}/books/{bookId}&quot;)
public ResponseEntity&lt;?&gt; addNewBookToReader(@PathVariable(&quot;readerId&quot;) int readerId, @PathVariable(&quot;bookId&quot;) int b
{
    Optional&lt;Reader&gt; readerOptional = readerRepository.findById(readerId);
    if(!readerOptional.isPresent())
    {
        throw new NotFoundException(&quot;reader-&quot; + readerId);
    }
    Optional&lt;Book&gt; bookOptional = bookRepository.findById(bookId);
    if(!bookOptional.isPresent())
    {
        throw new NotFoundException(&quot;book-&quot; + bookId);
    }
    Book book = bookOptional.get();
    Reader reader = readerOptional.get();
    if(!reader.getBooks().contains(book))
    {
        reader.addBook(book);
        readerRepository.save(reader);
        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand(reader.getReaderId(), book.getBookId())
                .toUri();
        return ResponseEntity.created(location).build();
    }
    return null;
}
@DeleteMapping(&quot;/readers/{readerId}/books/{bookId}&quot;)
public void deleteBookFromReader(@PathVariable(&quot;readerId&quot;) int readerId, @PathVariable(&quot;bookId&quot;) int bookId)
{
    Optional&lt;Reader&gt; readerOptional = readerRepository.findById(readerId);
    if(!readerOptional.isPresent())
    {
        throw new NotFoundException(&quot;reader-&quot; + readerId);
    }
    Optional&lt;Book&gt; bookOptional = bookRepository.findById(bookId);
    if(!bookOptional.isPresent())
    {
        throw new NotFoundException(&quot;book-&quot; + bookId);
    }
    Book book = bookOptional.get();
    Reader reader = readerOptional.get();
    if(!reader.getBooks().contains(book))
    {
        throw new NotFoundException(&quot;book-&quot; + bookId + &quot; in reader-&quot; + readerId);
    }
    reader.removeBook(book);
    readerRepository.save(reader);
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h3 id="LibraryApplicationRedesign-CheckhowHibernatewillenforceReferentialConstraints">Check how Hibernate will enforce Referential Constraints</h3><p>Our in-memory database creates association between Book with id=1 and Reader with id=1. Thus, it should not be possible to delete either Reader (with id=1) or Book (with id=1) without first deleting the association between these objects.</p><p>If we try to delete Reader with id=1</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 239.0px;"/><col style="width: 719.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>DELETE URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/readers/1" class="external-link" rel="nofollow">http://localhost:8080/readers/1</a></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-10-09T18:37:13.260+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;could not execute statement; SQL [n/a]; constraint [\&quot;FKT01DOUTW4PTDL5NGCCN3043N0: PUBLIC.READER_BOOK_MAP FOREIGN KEY(READER_ID) REFERENCES PUBLIC.READER(ID) (1)\&quot;; SQL statement:\ndelete from reader where id=? [23503-199]]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/readers/1&quot;</code><br/><code>}</code></p></td></tr></tbody></table></div><p>This is the expected response.</p><p>However, if we tried to delete a Book with id=1</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>DELETE URL</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p><a href="http://localhost:8080/books/1" class="external-link" rel="nofollow">http://localhost:8080/books/1</a></p></td><td class="confluenceTd"><p>Status: 200</p></td></tr></tbody></table></div><p>The Book object was deleted.</p><p>This problem can be fixed by adding a <code>CascadeType.ALL</code> property to the <code>@ManyToMany</code> annotation:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">...
@ManyToMany(cascade = { CascadeType.ALL })
@JoinTable(
        name = &quot;READER_BOOK_MAP&quot;,
        joinColumns = {@JoinColumn(name = &quot;BOOK_ID&quot;)},
        inverseJoinColumns = {@JoinColumn(name = &quot;READER_ID&quot;)})
private List&lt;Reader&gt; readers = new ArrayList&lt;&gt;();
...</pre>
</div></div></td></tr></tbody></table></div><h2 id="LibraryApplicationRedesign-TestPUT/POST/DELETEOperations">Test PUT/POST/DELETE Operations</h2><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289899163/289866624.png" data-image-src="attachments/289899163/289866624.png" data-height="268" data-width="753" data-unresolved-comment-count="0" data-linked-resource-id="289866624" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-120548.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289899163" data-linked-resource-container-version="1" data-media-id="e04704b4-3876-4600-b135-e78ac96565bb" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/289899163/289931698.png" data-image-src="attachments/289899163/289931698.png" data-height="332" data-width="752" data-unresolved-comment-count="0" data-linked-resource-id="289931698" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200420-120607.png" data-base-url="https://nickguner.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="289899163" data-linked-resource-container-version="1" data-media-id="574ccdc2-e500-42c2-92df-c64000828f5f" data-media-type="file"></span><p><br/></p><h2 id="LibraryApplicationRedesign-VerifyReferentialIntegrityBetweenReaderandBookObjects">Verify Referential Integrity Between Reader and Book Objects</h2><p>Out in-memory database defines a relationship between Reader and Book objects. Reader id=1 has two Books with id=1 and id=2. No other Reader has Book with id=1. To delete Book with id=1, we must first remove Book with id=1 from Reader with id=1.</p><div class="table-wrap"><table data-layout="wide" class="confluenceTable"><colgroup><col style="width: 177.0px;"/><col style="width: 272.0px;"/><col style="width: 509.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Command</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>DELETE EndPoint</strong></p></th><th data-highlight-colour="#f0f0f0" class="confluenceTh"><p><strong>Response</strong></p></th></tr><tr><td class="confluenceTd"><p>Delete Reader with id=1</p></td><td class="confluenceTd"><p><code>http://localhost:8080/readers/1</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-10-09T19:57:53.509+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;could not execute statement; SQL [n/a]; constraint [\&quot;FKT01DOUTW4PTDL5NGCCN3043N0: PUBLIC.READER_BOOK_MAP FOREIGN KEY(READER_ID) REFERENCES PUBLIC.READER(ID) (1)\&quot;; SQL statement:\ndelete from reader where id=? [23503-199]]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/readers/1&quot;</code><br/><code>}</code></p></td></tr><tr><td class="confluenceTd"><p>Delete Book with id=1</p></td><td class="confluenceTd"><p><code>http://localhost:8080/books/1</code></p></td><td class="confluenceTd"><p><code>{</code><br/><code> &quot;timestamp&quot;: &quot;2019-10-09T19:58:25.806+0000&quot;,</code><br/><code> &quot;message&quot;: &quot;could not execute statement; SQL [n/a]; constraint [\&quot;FKT01DOUTW4PTDL5NGCCN3043N0: PUBLIC.READER_BOOK_MAP FOREIGN KEY(READER_ID) REFERENCES PUBLIC.READER(ID) (1)\&quot;; SQL statement:\ndelete from reader where id=? [23503-199]]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement&quot;,</code><br/><code> &quot;details&quot;: &quot;uri=/books/1&quot;</code><br/><code>}</code></p></td></tr><tr><td class="confluenceTd"><p>Delete Book with id=1 from Reader with id=1</p></td><td class="confluenceTd"><p><code>http://localhost:8080/readers/1/books/1</code></p></td><td class="confluenceTd"><p><code>Status: 200</code></p></td></tr><tr><td class="confluenceTd"><p>Delete Book with id=1</p></td><td class="confluenceTd"><p><code>http://localhost:8080/books/1</code></p></td><td class="confluenceTd"><p><code>Status: 200</code></p></td></tr></tbody></table></div><p><br/></p><p><br/></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289899163/289866624.png">image-20200420-120548.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/289899163/289931698.png">image-20200420-120607.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
