'use strict';const express=require("express"),mongoose=require("mongoose"),app=express(),db=require("./config/keys").mongoURI,bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),users=require("./api/routes/users"),files=require("./api/routes/files"),passport=require("passport");require("./config/passport")(passport);require("dotenv").config();
mongoose.connect(db,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0,useFindAndModify:!1}).then(()=>app.listen(process.env.port||5E3)).catch(a=>console.log(a));app.use(bodyParser.urlencoded({extended:!1}));app.use((a,b,c)=>{b.header("Access-Control-Allow-Origin","*");b.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");c()});app.use(cookieParser());app.use(bodyParser.json());
app.use((a,b,c)=>{if(b=a.cookies.jwt)a.headers.authorization=`Bearer ${b}`;c()});app.use(passport.initialize());app.use("/api/users",users);app.use("/api/files",files);